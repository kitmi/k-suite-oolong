"use strict";

require("source-map-support/register");

const path = require('path');

const Util = require('rk-utils');

const Types = require('./types');

const basePath = path.resolve(__dirname, 'auto');
let generators = Util.fs.readdirSync(basePath);
let G = {};
generators.forEach(file => {
  let f = path.join(basePath, file);

  if (Util.fs.statSync(f).isFile() && Util._.endsWith(file, '.js')) {
    let g = path.basename(file, '.js');
    G[g] = require(f);
  }
});

function auto(info, i18n) {
  if (!Types.Builtin.has(info.type)) {
    throw new Error(`Unknown primitive type: "${info.type}"."`);
  }

  if (!info.auto) {
    throw new Error(`Not an automatically generated field "${info.name}".`);
  }

  if (info.generator) {
    let name, options;

    if (typeof info.generator === 'string') {
      name = info.generator;
    } else if (Array.isArray(info.generator)) {
      if (!(info.generator.length > 0)) {
        throw new Error("Function \"auto\" assertion failed: info.generator.length > 0");
      }

      name = info.generator[0];

      if (info.generator.length > 1) {
        options = info.generator[1];
      }
    } else {
      name = info.generator.name;
      options = info.generator.options;
    }

    let gtor = G[name];
    return gtor(info, i18n, options);
  }

  let typeObjerct = Types[info.type];
  return typeObjerct.generate(info, i18n);
}

;
module.exports = {
  'default': auto,
  ...G
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ydW50aW1lL0dlbmVyYXRvcnMuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJVdGlsIiwiVHlwZXMiLCJiYXNlUGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJnZW5lcmF0b3JzIiwiZnMiLCJyZWFkZGlyU3luYyIsIkciLCJmb3JFYWNoIiwiZmlsZSIsImYiLCJqb2luIiwic3RhdFN5bmMiLCJpc0ZpbGUiLCJfIiwiZW5kc1dpdGgiLCJnIiwiYmFzZW5hbWUiLCJhdXRvIiwiaW5mbyIsImkxOG4iLCJCdWlsdGluIiwiaGFzIiwidHlwZSIsIm5hbWUiLCJnZW5lcmF0b3IiLCJvcHRpb25zIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwiZ3RvciIsInR5cGVPYmplcmN0IiwiZ2VuZXJhdGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQUVBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQUFwQjs7QUFDQSxNQUFNRSxLQUFLLEdBQUdGLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUVBLE1BQU1HLFFBQVEsR0FBR0osSUFBSSxDQUFDSyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsTUFBeEIsQ0FBakI7QUFFQSxJQUFJQyxVQUFVLEdBQUdMLElBQUksQ0FBQ00sRUFBTCxDQUFRQyxXQUFSLENBQW9CTCxRQUFwQixDQUFqQjtBQUNBLElBQUlNLENBQUMsR0FBRyxFQUFSO0FBRUFILFVBQVUsQ0FBQ0ksT0FBWCxDQUFtQkMsSUFBSSxJQUFJO0FBQ3ZCLE1BQUlDLENBQUMsR0FBR2IsSUFBSSxDQUFDYyxJQUFMLENBQVVWLFFBQVYsRUFBb0JRLElBQXBCLENBQVI7O0FBQ0EsTUFBSVYsSUFBSSxDQUFDTSxFQUFMLENBQVFPLFFBQVIsQ0FBaUJGLENBQWpCLEVBQW9CRyxNQUFwQixNQUFnQ2QsSUFBSSxDQUFDZSxDQUFMLENBQU9DLFFBQVAsQ0FBZ0JOLElBQWhCLEVBQXNCLEtBQXRCLENBQXBDLEVBQWtFO0FBQzlELFFBQUlPLENBQUMsR0FBR25CLElBQUksQ0FBQ29CLFFBQUwsQ0FBY1IsSUFBZCxFQUFvQixLQUFwQixDQUFSO0FBQ0FGLElBQUFBLENBQUMsQ0FBQ1MsQ0FBRCxDQUFELEdBQU9sQixPQUFPLENBQUNZLENBQUQsQ0FBZDtBQUNIO0FBQ0osQ0FORDs7QUFRQSxTQUFTUSxJQUFULENBQWNDLElBQWQsRUFBb0JDLElBQXBCLEVBQTBCO0FBQUEsT0FFbEJwQixLQUFLLENBQUNxQixPQUFOLENBQWNDLEdBQWQsQ0FBa0JILElBQUksQ0FBQ0ksSUFBdkIsQ0FGa0I7QUFBQSxvQkFFYSw0QkFBMkJKLElBQUksQ0FBQ0ksSUFBSyxLQUZsRDtBQUFBOztBQUFBLE9BR2xCSixJQUFJLENBQUNELElBSGE7QUFBQSxvQkFHTix5Q0FBeUNDLElBQUksQ0FBQ0ssSUFBTSxJQUg5QztBQUFBOztBQU10QixNQUFJTCxJQUFJLENBQUNNLFNBQVQsRUFBb0I7QUFDaEIsUUFBSUQsSUFBSixFQUFVRSxPQUFWOztBQUdBLFFBQUksT0FBT1AsSUFBSSxDQUFDTSxTQUFaLEtBQTBCLFFBQTlCLEVBQXdDO0FBQ3BDRCxNQUFBQSxJQUFJLEdBQUdMLElBQUksQ0FBQ00sU0FBWjtBQUNILEtBRkQsTUFFTyxJQUFJRSxLQUFLLENBQUNDLE9BQU4sQ0FBY1QsSUFBSSxDQUFDTSxTQUFuQixDQUFKLEVBQW1DO0FBQUEsWUFDOUJOLElBQUksQ0FBQ00sU0FBTCxDQUFlSSxNQUFmLEdBQXdCLENBRE07QUFBQTtBQUFBOztBQUV0Q0wsTUFBQUEsSUFBSSxHQUFHTCxJQUFJLENBQUNNLFNBQUwsQ0FBZSxDQUFmLENBQVA7O0FBRUEsVUFBSU4sSUFBSSxDQUFDTSxTQUFMLENBQWVJLE1BQWYsR0FBd0IsQ0FBNUIsRUFBK0I7QUFDM0JILFFBQUFBLE9BQU8sR0FBR1AsSUFBSSxDQUFDTSxTQUFMLENBQWUsQ0FBZixDQUFWO0FBQ0g7QUFDSixLQVBNLE1BT0E7QUFDSEQsTUFBQUEsSUFBSSxHQUFHTCxJQUFJLENBQUNNLFNBQUwsQ0FBZUQsSUFBdEI7QUFDQUUsTUFBQUEsT0FBTyxHQUFHUCxJQUFJLENBQUNNLFNBQUwsQ0FBZUMsT0FBekI7QUFDSDs7QUFFRCxRQUFJSSxJQUFJLEdBQUd2QixDQUFDLENBQUNpQixJQUFELENBQVo7QUFDQSxXQUFPTSxJQUFJLENBQUNYLElBQUQsRUFBT0MsSUFBUCxFQUFhTSxPQUFiLENBQVg7QUFDSDs7QUFFRCxNQUFJSyxXQUFXLEdBQUcvQixLQUFLLENBQUNtQixJQUFJLENBQUNJLElBQU4sQ0FBdkI7QUFDQSxTQUFPUSxXQUFXLENBQUNDLFFBQVosQ0FBcUJiLElBQXJCLEVBQTJCQyxJQUEzQixDQUFQO0FBQ0g7O0FBQUE7QUFFRGEsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2IsYUFBV2hCLElBREU7QUFFYixLQUFHWDtBQUZVLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBVdGlsID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IFR5cGVzID0gcmVxdWlyZSgnLi90eXBlcycpO1xuXG5jb25zdCBiYXNlUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdhdXRvJyk7XG5cbmxldCBnZW5lcmF0b3JzID0gVXRpbC5mcy5yZWFkZGlyU3luYyhiYXNlUGF0aCk7XG5sZXQgRyA9IHt9O1xuXG5nZW5lcmF0b3JzLmZvckVhY2goZmlsZSA9PiB7XG4gICAgbGV0IGYgPSBwYXRoLmpvaW4oYmFzZVBhdGgsIGZpbGUpO1xuICAgIGlmIChVdGlsLmZzLnN0YXRTeW5jKGYpLmlzRmlsZSgpICYmIFV0aWwuXy5lbmRzV2l0aChmaWxlLCAnLmpzJykpIHtcbiAgICAgICAgbGV0IGcgPSBwYXRoLmJhc2VuYW1lKGZpbGUsICcuanMnKTtcbiAgICAgICAgR1tnXSA9IHJlcXVpcmUoZik7XG4gICAgfVxufSk7XG5cbmZ1bmN0aW9uIGF1dG8oaW5mbywgaTE4bikge1xuICAgIHByZToge1xuICAgICAgICBUeXBlcy5CdWlsdGluLmhhcyhpbmZvLnR5cGUpLCBgVW5rbm93biBwcmltaXRpdmUgdHlwZTogXCIke2luZm8udHlwZX1cIi5cImA7XG4gICAgICAgIGluZm8uYXV0bywgYE5vdCBhbiBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBmaWVsZCBcIiR7IGluZm8ubmFtZSB9XCIuYDtcbiAgICB9XG5cbiAgICBpZiAoaW5mby5nZW5lcmF0b3IpIHtcbiAgICAgICAgbGV0IG5hbWUsIG9wdGlvbnM7XG5cbiAgICAgICAgLy9jdXN0b21pemVkIGdlbmVyYXRvclxuICAgICAgICBpZiAodHlwZW9mIGluZm8uZ2VuZXJhdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbmFtZSA9IGluZm8uZ2VuZXJhdG9yO1xuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaW5mby5nZW5lcmF0b3IpKSB7XG4gICAgICAgICAgICBhc3NlcnQ6IGluZm8uZ2VuZXJhdG9yLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBuYW1lID0gaW5mby5nZW5lcmF0b3JbMF07XG5cbiAgICAgICAgICAgIGlmIChpbmZvLmdlbmVyYXRvci5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IGluZm8uZ2VuZXJhdG9yWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmFtZSA9IGluZm8uZ2VuZXJhdG9yLm5hbWU7XG4gICAgICAgICAgICBvcHRpb25zID0gaW5mby5nZW5lcmF0b3Iub3B0aW9ucztcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBndG9yID0gR1tuYW1lXTtcbiAgICAgICAgcmV0dXJuIGd0b3IoaW5mbywgaTE4biwgb3B0aW9ucyk7XG4gICAgfSBcblxuICAgIGxldCB0eXBlT2JqZXJjdCA9IFR5cGVzW2luZm8udHlwZV07XG4gICAgcmV0dXJuIHR5cGVPYmplcmN0LmdlbmVyYXRlKGluZm8sIGkxOG4pO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgJ2RlZmF1bHQnOiBhdXRvLFxuICAgIC4uLkdcbn07Il19