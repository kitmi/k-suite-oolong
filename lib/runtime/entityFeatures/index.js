"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  fs,
  eachAsync_
} = require('rk-utils');

const {
  HashRules
} = require('@k-suite/rules-engine');

const basePath = path.resolve(__dirname);
const features = fs.readdirSync(basePath);
const featureRules = new HashRules();
features.forEach(file => {
  let f = path.join(basePath, file);

  if (fs.statSync(f).isFile() && _.endsWith(file, '.js')) {
    let g = path.basename(file, '.js');
    if (g === 'index') return;

    let feature = require(f);

    _.forOwn(feature, (actions, ruleName) => featureRules.addRule(g + '.' + ruleName, actions));
  }
});
module.exports = {
  applyRules_: async (ruleName, entityModel, context) => eachAsync_(entityModel.meta.features, (feature, name) => featureRules.run_(name + '.' + ruleName, {
    feature,
    entityModel,
    context
  }))
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ydW50aW1lL2VudGl0eUZlYXR1cmVzL2luZGV4LmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwiXyIsImZzIiwiZWFjaEFzeW5jXyIsIkhhc2hSdWxlcyIsImJhc2VQYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsImZlYXR1cmVzIiwicmVhZGRpclN5bmMiLCJmZWF0dXJlUnVsZXMiLCJmb3JFYWNoIiwiZmlsZSIsImYiLCJqb2luIiwic3RhdFN5bmMiLCJpc0ZpbGUiLCJlbmRzV2l0aCIsImciLCJiYXNlbmFtZSIsImZlYXR1cmUiLCJmb3JPd24iLCJhY3Rpb25zIiwicnVsZU5hbWUiLCJhZGRSdWxlIiwibW9kdWxlIiwiZXhwb3J0cyIsImFwcGx5UnVsZXNfIiwiZW50aXR5TW9kZWwiLCJjb250ZXh0IiwibWV0YSIsIm5hbWUiLCJydW5fIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQUVBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTTtBQUFFQyxFQUFBQSxDQUFGO0FBQUtDLEVBQUFBLEVBQUw7QUFBU0MsRUFBQUE7QUFBVCxJQUF3QkgsT0FBTyxDQUFDLFVBQUQsQ0FBckM7O0FBQ0EsTUFBTTtBQUFFSSxFQUFBQTtBQUFGLElBQWdCSixPQUFPLENBQUMsdUJBQUQsQ0FBN0I7O0FBRUEsTUFBTUssUUFBUSxHQUFHTixJQUFJLENBQUNPLE9BQUwsQ0FBYUMsU0FBYixDQUFqQjtBQUNBLE1BQU1DLFFBQVEsR0FBR04sRUFBRSxDQUFDTyxXQUFILENBQWVKLFFBQWYsQ0FBakI7QUFFQSxNQUFNSyxZQUFZLEdBQUcsSUFBSU4sU0FBSixFQUFyQjtBQUVBSSxRQUFRLENBQUNHLE9BQVQsQ0FBaUJDLElBQUksSUFBSTtBQUNyQixNQUFJQyxDQUFDLEdBQUdkLElBQUksQ0FBQ2UsSUFBTCxDQUFVVCxRQUFWLEVBQW9CTyxJQUFwQixDQUFSOztBQUNBLE1BQUlWLEVBQUUsQ0FBQ2EsUUFBSCxDQUFZRixDQUFaLEVBQWVHLE1BQWYsTUFBMkJmLENBQUMsQ0FBQ2dCLFFBQUYsQ0FBV0wsSUFBWCxFQUFpQixLQUFqQixDQUEvQixFQUF3RDtBQUNwRCxRQUFJTSxDQUFDLEdBQUduQixJQUFJLENBQUNvQixRQUFMLENBQWNQLElBQWQsRUFBb0IsS0FBcEIsQ0FBUjtBQUNBLFFBQUlNLENBQUMsS0FBSyxPQUFWLEVBQW1COztBQUVuQixRQUFJRSxPQUFPLEdBQUdwQixPQUFPLENBQUNhLENBQUQsQ0FBckI7O0FBRUFaLElBQUFBLENBQUMsQ0FBQ29CLE1BQUYsQ0FBU0QsT0FBVCxFQUFrQixDQUFDRSxPQUFELEVBQVVDLFFBQVYsS0FBdUJiLFlBQVksQ0FBQ2MsT0FBYixDQUFxQk4sQ0FBQyxHQUFDLEdBQUYsR0FBTUssUUFBM0IsRUFBcUNELE9BQXJDLENBQXpDO0FBQ0g7QUFDSixDQVZEO0FBWUFHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQUNiQyxFQUFBQSxXQUFXLEVBQUUsT0FBT0osUUFBUCxFQUFpQkssV0FBakIsRUFBOEJDLE9BQTlCLEtBQ1QxQixVQUFVLENBQUN5QixXQUFXLENBQUNFLElBQVosQ0FBaUJ0QixRQUFsQixFQUE0QixDQUFDWSxPQUFELEVBQVVXLElBQVYsS0FBbUJyQixZQUFZLENBQUNzQixJQUFiLENBQWtCRCxJQUFJLEdBQUcsR0FBUCxHQUFhUixRQUEvQixFQUF5QztBQUFFSCxJQUFBQSxPQUFGO0FBQVdRLElBQUFBLFdBQVg7QUFBd0JDLElBQUFBO0FBQXhCLEdBQXpDLENBQS9DO0FBRkQsQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IHsgXywgZnMsIGVhY2hBc3luY18gfSA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5jb25zdCB7IEhhc2hSdWxlcyB9ID0gcmVxdWlyZSgnQGstc3VpdGUvcnVsZXMtZW5naW5lJyk7XG5cbmNvbnN0IGJhc2VQYXRoID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSk7XG5jb25zdCBmZWF0dXJlcyA9IGZzLnJlYWRkaXJTeW5jKGJhc2VQYXRoKTtcblxuY29uc3QgZmVhdHVyZVJ1bGVzID0gbmV3IEhhc2hSdWxlcygpO1xuXG5mZWF0dXJlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgIGxldCBmID0gcGF0aC5qb2luKGJhc2VQYXRoLCBmaWxlKTtcbiAgICBpZiAoZnMuc3RhdFN5bmMoZikuaXNGaWxlKCkgJiYgXy5lbmRzV2l0aChmaWxlLCAnLmpzJykpIHtcbiAgICAgICAgbGV0IGcgPSBwYXRoLmJhc2VuYW1lKGZpbGUsICcuanMnKTtcbiAgICAgICAgaWYgKGcgPT09ICdpbmRleCcpIHJldHVybjtcblxuICAgICAgICBsZXQgZmVhdHVyZSA9IHJlcXVpcmUoZik7XG5cbiAgICAgICAgXy5mb3JPd24oZmVhdHVyZSwgKGFjdGlvbnMsIHJ1bGVOYW1lKSA9PiBmZWF0dXJlUnVsZXMuYWRkUnVsZShnKycuJytydWxlTmFtZSwgYWN0aW9ucykpOyAgICAgIFxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBhcHBseVJ1bGVzXzogYXN5bmMgKHJ1bGVOYW1lLCBlbnRpdHlNb2RlbCwgY29udGV4dCkgPT4gXG4gICAgICAgIGVhY2hBc3luY18oZW50aXR5TW9kZWwubWV0YS5mZWF0dXJlcywgKGZlYXR1cmUsIG5hbWUpID0+IGZlYXR1cmVSdWxlcy5ydW5fKG5hbWUgKyAnLicgKyBydWxlTmFtZSwgeyBmZWF0dXJlLCBlbnRpdHlNb2RlbCwgY29udGV4dCB9KSkgICAgXG59OyJdfQ==