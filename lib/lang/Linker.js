"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  fs,
  glob
} = require('rk-utils');

const Oolong = require('./grammar/oolong');

const OolongParser = Oolong.parser;

const OolTypes = require('./OolTypes');

const Types = require('../runtime/types');

const Entity = require('./Entity');

const Schema = require('./Schema');

const View = require('./View');

const Dataset = require('./Dataset');

const ELEMENT_CLASS_MAP = {
  [OolTypes.Element.ENTITY]: Entity,
  [OolTypes.Element.VIEW]: View,
  [OolTypes.Element.DATASET]: Dataset
};
const OOLONG_SOURCE_EXT = '.ool';
const BUILTINS_PATH = path.resolve(__dirname, 'builtins');

class Linker {
  static getOolongFiles(sourceDir, useJsonSource, recursive) {
    let pattern = '*' + OOLONG_SOURCE_EXT;

    if (useJsonSource) {
      pattern += '.json';
    }

    if (recursive) {
      pattern = '**/' + pattern;
    }

    return glob.sync(path.join(sourceDir, pattern), {
      nodir: true
    });
  }

  constructor(context) {
    this.logger = context.logger;
    this.sourcePath = context.dslSourcePath;
    this.useJsonSource = context.useJsonSource || false;
    this.saveIntermediate = context.saveIntermediate || false;
    this.schemas = {};
    this._oolModules = {};
    this._elementsCache = {};
    this._mapOfReferenceToModuleId = new Map();
  }

  log(level, message, data) {
    if (!this.logger) return;

    if (data) {
      this.logger.log(level, message, data);
    } else {
      this.logger.log(level, message);
    }
  }

  isModuleLoaded(moduleId) {
    return moduleId in this._oolModules;
  }

  getModuleById(moduleId) {
    return this._oolModules[moduleId];
  }

  link(entryFileName) {
    let entryModule = this.loadModule(entryFileName);

    if (!entryModule) {
      throw new Error(`Cannot resolve file "${entryFileName}".`);
    }

    if (_.isEmpty(entryModule.schema)) {
      throw new Error('No schema defined in entry file.');
    }

    _.forOwn(entryModule.schema, (schemaInfo, schemaName) => {
      let schema = new Schema(this, schemaName, entryModule, schemaInfo);
      schema.link();

      if (this.schemas.hasOwnProperty(schemaName)) {
        throw new Error(`Duplicate schema: "${schemaName}".`);
      }

      this.schemas[schemaName] = schema;

      if (this.saveIntermediate) {
        let jsFile = path.resolve(this.sourcePath, entryFileName + '-linked.json');
        fs.writeFileSync(jsFile, JSON.stringify(schema.toJSON(), null, 4));
      }
    });
  }

  loadModule(modulePath) {
    modulePath = path.resolve(this.sourcePath, modulePath);
    let id = this.getModuleIdByPath(modulePath);

    if (this.isModuleLoaded(id)) {
      return this.getModuleById(id);
    }

    if (!fs.existsSync(modulePath)) {
      return undefined;
    }

    let ool = this._compile(modulePath);

    return this._oolModules[id] = ool;
  }

  trackBackType(oolModule, info) {
    if (Types.Builtin.has(info.type)) {
      return info;
    }

    let baseInfo = this.loadElement(oolModule, OolTypes.Element.TYPE, info.type);

    if (!Types.Builtin.has(baseInfo.type)) {
      let uniqueId = this.getElementUniqueId(oolModule, OolTypes.Element.TYPE, value.name);
      let ownerModule = this.getModuleById(this._mapOfReferenceToModuleId.get(uniqueId));
      let rootTypeInfo = this.trackBackType(ownerModule, baseInfo);
      ownerModule.type[baseInfo.type] = rootTypeInfo;
      baseInfo = rootTypeInfo;
    }

    let derivedInfo = { ..._.cloneDeep(_.omit(baseInfo, ['modifiers'])),
      ..._.omit(info, ['type', 'modifiers'])
    };

    if (baseInfo.modifiers || info.modifiers) {
      derivedInfo.modifiers = [...(baseInfo.modifiers || []), ...(info.modifiers || [])];
    }

    if (!derivedInfo.subClass) {
      derivedInfo.subClass = [];
    }

    derivedInfo.subClass.push(info.type);
    return derivedInfo;
  }

  translateOolValue(oolModule, value) {
    if (_.isPlainObject(value)) {
      if (value.oolType === OolTypes.Lang.CONST_REF) {
        let refedValue = this.loadElement(oolModule, OolTypes.Element.CONST, value.name);
        let uniqueId = this.getElementUniqueId(oolModule, OolTypes.Element.CONST, value.name);
        let ownerModule = this.getModuleById(this._mapOfReferenceToModuleId.get(uniqueId));
        return this.translateOolValue(ownerModule, refedValue);
      } else if (value.oolType) {
        throw new Error(`todo: translateOolValue with type: ${value.oolType}`);
      }

      return _.mapValues(value, v => this.translateOolValue(oolModule, v));
    }

    if (Array.isArray(value)) {
      return value.map(v => this.translateOolValue(oolModule, v));
    }

    return value;
  }

  getModuleIdByPath(modulePath) {
    let isBuiltinEntity = _.startsWith(modulePath, BUILTINS_PATH);

    return isBuiltinEntity ? path.relative(BUILTINS_PATH, modulePath) : './' + path.relative(this.sourcePath, modulePath);
  }

  getElementUniqueId(refererModule, elementType, elementName) {
    return elementType + ':' + elementName + '<-' + refererModule.id;
  }

  loadEntity(refererModule, elementName) {
    return this.loadElement(refererModule, OolTypes.Element.ENTITY, elementName);
  }

  loadType(refererModule, elementName) {
    return this.loadElement(refererModule, OolTypes.Element.TYPE, elementName);
  }

  loadDataset(refererModule, elementName) {
    return this.loadElement(refererModule, OolTypes.Element.DATASET, elementName);
  }

  loadView(refererModule, elementName) {
    return this.loadElement(refererModule, OolTypes.Element.VIEW, elementName);
  }

  loadElement(refererModule, elementType, elementName) {
    let uniqueId = this.getElementUniqueId(refererModule, elementType, elementName);

    if (uniqueId in this._elementsCache) {
      return this._elementsCache[uniqueId];
    }

    let targetModule;

    if (elementType in refererModule && elementName in refererModule[elementType]) {
      targetModule = refererModule;
    } else {
      this.log('verbose', `Searching ${elementType} "${elementName}" from "${refererModule.id}" ...`);

      let index = _.findLastIndex(refererModule.namespace, modulePath => {
        targetModule = this.loadModule(modulePath);
        return targetModule && targetModule[elementType] && elementName in targetModule[elementType];
      });

      if (index === -1) {
        throw new Error(`${elementType} "${elementName}" not found in imported namespaces. Referer: ${refererModule.id}`);
      }
    }

    this.log('verbose', `Found ${elementType} "${elementName}" in "${targetModule.id}". [OK]`);
    let elementSelfId = elementType + ':' + elementName + '@' + targetModule.id;

    if (elementSelfId in this._elementsCache) {
      return this._elementsCache[uniqueId] = this._elementsCache[elementSelfId];
    }

    if (!!this._mapOfReferenceToModuleId.has(uniqueId)) {
      throw new Error(`${elementType} "${elementName}" in "${targetModule.id}" conflicts with ${elementType} in "${this._mapOfReferenceToModuleId.get(uniqueId)}"!`);
    }

    this._mapOfReferenceToModuleId.set(uniqueId, targetModule.id);

    let elementInfo = Object.freeze(targetModule[elementType][elementName]);
    let element;

    if (elementType in ELEMENT_CLASS_MAP) {
      let ElementClass = ELEMENT_CLASS_MAP[elementType];
      element = new ElementClass(this, elementName, targetModule, elementInfo);
      element.link();
    } else {
      element = elementInfo;
    }

    this._elementsCache[elementSelfId] = element;
    this._elementsCache[uniqueId] = element;
    return element;
  }

  _compile(oolFile) {
    let jsFile;

    if (oolFile.endsWith('.json')) {
      jsFile = oolFile;
      oolFile = oolFile.substr(0, oolFile.length - 5);
    } else {
      jsFile = oolFile + '.json';
    }

    let ool, searchExt;

    if (this.useJsonSource) {
      if (!fs.existsSync(jsFile)) {
        throw new Error(`"useJsonSource" enabeld but json file "${jsFile}" not found.`);
      }

      ool = fs.readJsonSync(jsFile);
      searchExt = OOLONG_SOURCE_EXT + '.json';
    } else {
      this.log('debug', 'Compiling ' + oolFile + ' ...');

      try {
        ool = OolongParser.parse(fs.readFileSync(oolFile, 'utf8'));
      } catch (error) {
        throw new Error(`Failed to compile "${oolFile}".\n${error.message || error}`);
      }

      if (!ool) {
        throw new Error('Unknown error occurred while compiling.');
      }

      searchExt = OOLONG_SOURCE_EXT;
    }

    let baseName = path.basename(oolFile, OOLONG_SOURCE_EXT);
    let namespace = [];
    let currentPath = path.dirname(oolFile);

    function expandNs(namespaces, ns, recursive) {
      let stats = fs.statSync(ns);

      if (stats.isFile() && ns.endsWith(searchExt)) {
        namespaces.push(ns);
        return;
      }

      if (stats.isDirectory() && recursive) {
        let files = fs.readdirSync(ns);
        files.forEach(f => expandNs(namespaces, path.join(ns, f), true));
      }
    }

    if (ool.namespace) {
      ool.namespace.forEach(ns => {
        let p;

        if (ns.startsWith('<oolong>/')) {
          ns = path.join(BUILTINS_PATH, ns.substr(9));
        } else if (ns.startsWith('<source>/')) {
          ns = path.join(this.sourcePath, ns.substr(9));
        }

        if (ns.endsWith('/*')) {
          p = path.resolve(currentPath, ns.substr(0, ns.length - 2));
          let files = fs.readdirSync(p);
          files.forEach(f => expandNs(namespace, path.join(p, f), false));
        } else if (ns.endsWith('/**')) {
          p = path.resolve(currentPath, ns.substr(0, ns.length - 3));
          let files = fs.readdirSync(p);
          files.forEach(f => expandNs(namespace, path.join(p, f), true));
        } else {
          namespace.push(path.resolve(currentPath, _.endsWith(ns, OOLONG_SOURCE_EXT) ? ns : ns + OOLONG_SOURCE_EXT));
        }
      });
    }

    ool.namespace = namespace;
    ool.id = this.getModuleIdByPath(oolFile);
    ool.name = baseName;

    if (!this.useJsonSource && this.saveIntermediate) {
      fs.writeFileSync(jsFile, JSON.stringify(ool, null, 4));
    }

    return ool;
  }

}

module.exports = Linker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9sYW5nL0xpbmtlci5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsIl8iLCJmcyIsImdsb2IiLCJPb2xvbmciLCJPb2xvbmdQYXJzZXIiLCJwYXJzZXIiLCJPb2xUeXBlcyIsIlR5cGVzIiwiRW50aXR5IiwiU2NoZW1hIiwiVmlldyIsIkRhdGFzZXQiLCJFTEVNRU5UX0NMQVNTX01BUCIsIkVsZW1lbnQiLCJFTlRJVFkiLCJWSUVXIiwiREFUQVNFVCIsIk9PTE9OR19TT1VSQ0VfRVhUIiwiQlVJTFRJTlNfUEFUSCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJMaW5rZXIiLCJnZXRPb2xvbmdGaWxlcyIsInNvdXJjZURpciIsInVzZUpzb25Tb3VyY2UiLCJyZWN1cnNpdmUiLCJwYXR0ZXJuIiwic3luYyIsImpvaW4iLCJub2RpciIsImNvbnN0cnVjdG9yIiwiY29udGV4dCIsImxvZ2dlciIsInNvdXJjZVBhdGgiLCJkc2xTb3VyY2VQYXRoIiwic2F2ZUludGVybWVkaWF0ZSIsInNjaGVtYXMiLCJfb29sTW9kdWxlcyIsIl9lbGVtZW50c0NhY2hlIiwiX21hcE9mUmVmZXJlbmNlVG9Nb2R1bGVJZCIsIk1hcCIsImxvZyIsImxldmVsIiwibWVzc2FnZSIsImRhdGEiLCJpc01vZHVsZUxvYWRlZCIsIm1vZHVsZUlkIiwiZ2V0TW9kdWxlQnlJZCIsImxpbmsiLCJlbnRyeUZpbGVOYW1lIiwiZW50cnlNb2R1bGUiLCJsb2FkTW9kdWxlIiwiRXJyb3IiLCJpc0VtcHR5Iiwic2NoZW1hIiwiZm9yT3duIiwic2NoZW1hSW5mbyIsInNjaGVtYU5hbWUiLCJoYXNPd25Qcm9wZXJ0eSIsImpzRmlsZSIsIndyaXRlRmlsZVN5bmMiLCJKU09OIiwic3RyaW5naWZ5IiwidG9KU09OIiwibW9kdWxlUGF0aCIsImlkIiwiZ2V0TW9kdWxlSWRCeVBhdGgiLCJleGlzdHNTeW5jIiwidW5kZWZpbmVkIiwib29sIiwiX2NvbXBpbGUiLCJ0cmFja0JhY2tUeXBlIiwib29sTW9kdWxlIiwiaW5mbyIsIkJ1aWx0aW4iLCJoYXMiLCJ0eXBlIiwiYmFzZUluZm8iLCJsb2FkRWxlbWVudCIsIlRZUEUiLCJ1bmlxdWVJZCIsImdldEVsZW1lbnRVbmlxdWVJZCIsInZhbHVlIiwibmFtZSIsIm93bmVyTW9kdWxlIiwiZ2V0Iiwicm9vdFR5cGVJbmZvIiwiZGVyaXZlZEluZm8iLCJjbG9uZURlZXAiLCJvbWl0IiwibW9kaWZpZXJzIiwic3ViQ2xhc3MiLCJwdXNoIiwidHJhbnNsYXRlT29sVmFsdWUiLCJpc1BsYWluT2JqZWN0Iiwib29sVHlwZSIsIkxhbmciLCJDT05TVF9SRUYiLCJyZWZlZFZhbHVlIiwiQ09OU1QiLCJtYXBWYWx1ZXMiLCJ2IiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiaXNCdWlsdGluRW50aXR5Iiwic3RhcnRzV2l0aCIsInJlbGF0aXZlIiwicmVmZXJlck1vZHVsZSIsImVsZW1lbnRUeXBlIiwiZWxlbWVudE5hbWUiLCJsb2FkRW50aXR5IiwibG9hZFR5cGUiLCJsb2FkRGF0YXNldCIsImxvYWRWaWV3IiwidGFyZ2V0TW9kdWxlIiwiaW5kZXgiLCJmaW5kTGFzdEluZGV4IiwibmFtZXNwYWNlIiwiZWxlbWVudFNlbGZJZCIsInNldCIsImVsZW1lbnRJbmZvIiwiT2JqZWN0IiwiZnJlZXplIiwiZWxlbWVudCIsIkVsZW1lbnRDbGFzcyIsIm9vbEZpbGUiLCJlbmRzV2l0aCIsInN1YnN0ciIsImxlbmd0aCIsInNlYXJjaEV4dCIsInJlYWRKc29uU3luYyIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwiZXJyb3IiLCJiYXNlTmFtZSIsImJhc2VuYW1lIiwiY3VycmVudFBhdGgiLCJkaXJuYW1lIiwiZXhwYW5kTnMiLCJuYW1lc3BhY2VzIiwibnMiLCJzdGF0cyIsInN0YXRTeW5jIiwiaXNGaWxlIiwiaXNEaXJlY3RvcnkiLCJmaWxlcyIsInJlYWRkaXJTeW5jIiwiZm9yRWFjaCIsImYiLCJwIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFB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LE9BQVAsR0FBaUJuSSxNQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBfLCBmcywgZ2xvYiB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcblxuY29uc3QgT29sb25nID0gcmVxdWlyZSgnLi9ncmFtbWFyL29vbG9uZycpO1xuY29uc3QgT29sb25nUGFyc2VyID0gT29sb25nLnBhcnNlcjtcbmNvbnN0IE9vbFR5cGVzID0gcmVxdWlyZSgnLi9Pb2xUeXBlcycpO1xuY29uc3QgVHlwZXMgPSByZXF1aXJlKCcuLi9ydW50aW1lL3R5cGVzJyk7XG5cbmNvbnN0IEVudGl0eSA9IHJlcXVpcmUoJy4vRW50aXR5Jyk7XG5jb25zdCBTY2hlbWEgPSByZXF1aXJlKCcuL1NjaGVtYScpO1xuY29uc3QgVmlldyA9IHJlcXVpcmUoJy4vVmlldycpO1xuY29uc3QgRGF0YXNldCA9IHJlcXVpcmUoJy4vRGF0YXNldCcpO1xuXG5jb25zdCBFTEVNRU5UX0NMQVNTX01BUCA9IHtcbiAgICBbT29sVHlwZXMuRWxlbWVudC5FTlRJVFldOiBFbnRpdHksXG4gICAgW09vbFR5cGVzLkVsZW1lbnQuVklFV106IFZpZXcsXG4gICAgW09vbFR5cGVzLkVsZW1lbnQuREFUQVNFVF06IERhdGFzZXQsXG59O1xuXG5jb25zdCBPT0xPTkdfU09VUkNFX0VYVCA9ICcub29sJztcbmNvbnN0IEJVSUxUSU5TX1BBVEggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnYnVpbHRpbnMnKTtcblxuLyoqXG4gKiBMaW5rZXIgb2Ygb29sb25nIERTTFxuICogQGNsYXNzIE9vbG9uZ0xpbmtlclxuICovXG5jbGFzcyBMaW5rZXIge1xuICAgIHN0YXRpYyBnZXRPb2xvbmdGaWxlcyhzb3VyY2VEaXIsIHVzZUpzb25Tb3VyY2UsIHJlY3Vyc2l2ZSkge1xuICAgICAgICBsZXQgcGF0dGVybiA9ICcqJyArIE9PTE9OR19TT1VSQ0VfRVhUO1xuXG4gICAgICAgIGlmICh1c2VKc29uU291cmNlKSB7XG4gICAgICAgICAgICBwYXR0ZXJuICs9ICcuanNvbic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmVjdXJzaXZlKSB7XG4gICAgICAgICAgICBwYXR0ZXJuID0gJyoqLycgKyBwYXR0ZXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGdsb2Iuc3luYyhwYXRoLmpvaW4oc291cmNlRGlyLCBwYXR0ZXJuKSwge25vZGlyOiB0cnVlfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbnRleHRcbiAgICAgKiBAcHJvcGVydHkge0xvZ2dlcn0gY29udGV4dC5sb2dnZXIgLSBMb2dnZXIgb2JqZWN0XG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IGNvbnRleHQuZHNsU291cmNlUGF0aCAtIE9vbG9uZyBzb3VyY2UgZmlsZXMgcGF0aCAgICAgXG4gICAgICogQHByb3BlcnR5IHtib29sfSBbY29udGV4dC51c2VKc29uU291cmNlPWZhbHNlXSAtIFVzZSAuanNvbiBpbnRlcm1lZGlhdGUgc291cmNlIGZpbGUgaW5zdGVhZCBvZiAub29sXG4gICAgICogQHByb3BlcnR5IHtib29sfSBbY29udGV4dC5zYXZlSW50ZXJtZWRpYXRlPWZhbHNlXSAtIFNhdmUgaW50ZXJtZWRpYXRlIHNvdXJjZSBmaWxlIHdoaWxlIGxpbmtpbmdcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb250ZXh0KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2dnZXJcbiAgICAgICAgICogQG1lbWJlciB7TG9nZ2VyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sb2dnZXIgPSBjb250ZXh0LmxvZ2dlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogT29sb25nIHNvdXJjZSBmaWxlcyBwYXRoXG4gICAgICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc291cmNlUGF0aCA9IGNvbnRleHQuZHNsU291cmNlUGF0aDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXNlIGpzb24gb3Igb2xzXG4gICAgICAgICAqIEBtZW1iZXIge2Jvb2x9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZUpzb25Tb3VyY2UgPSBjb250ZXh0LnVzZUpzb25Tb3VyY2UgfHwgZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNhdmUgaW50ZXJtZWRpYXRlIGZpbGVzXG4gICAgICAgICAqIEBtZW1iZXIge2Jvb2x9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNhdmVJbnRlcm1lZGlhdGUgPSBjb250ZXh0LnNhdmVJbnRlcm1lZGlhdGUgfHwgZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpbmtlZCBzY2hlbWFzXG4gICAgICAgICAqIEBtZW1iZXIge29iamVjdC48c3RyaW5nLCBTY2hlbWE+fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zY2hlbWFzID0ge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnNlZCBvb2xvbmcgZmlsZXMsIHBhdGggPT4gbW9kdWxlXG4gICAgICAgICAqIEBtZW1iZXIge29iamVjdH1cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX29vbE1vZHVsZXMgPSB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRWxlbWVudCBjYWNoZSwgbWFwIG9mIDxyZWZlcmVuY2VJZCwgZWxlbWVudD4gYW5kIDxzZWxmSWQsIGVsZW1lbnQ+XG4gICAgICAgICAqIEBtZW1iZXIge29iamVjdH0gXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9lbGVtZW50c0NhY2hlID0ge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcCBvZiA8cmVmZXJlbmNlSWQsIG1vZHVsZUlkPlxuICAgICAgICAgKiBAbWVtYmVyIHtvYmplY3R9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9tYXBPZlJlZmVyZW5jZVRvTW9kdWxlSWQgPSBuZXcgTWFwKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV3JpdGUgbG9nXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGxldmVsXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2VcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdXG4gICAgICovXG4gICAgbG9nKGxldmVsLCBtZXNzYWdlLCBkYXRhKSB7XG4gICAgICAgIGlmICghdGhpcy5sb2dnZXIpIHJldHVybjtcblxuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKGxldmVsLCBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZyhsZXZlbCwgbWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayB3aGV0aGVyIGEgbW9kdWxlIGlzIGxvYWRlZFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtb2R1bGVJZFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqL1xuICAgIGlzTW9kdWxlTG9hZGVkKG1vZHVsZUlkKSB7XG4gICAgICAgIHJldHVybiBtb2R1bGVJZCBpbiB0aGlzLl9vb2xNb2R1bGVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIGxvYWRlZCBvb2xvbmUgbW9kdWxlXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZHVsZUlkXG4gICAgICogQHJldHVybnMge29iamVjdH1cbiAgICAgKi9cbiAgICBnZXRNb2R1bGVCeUlkKG1vZHVsZUlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vb2xNb2R1bGVzW21vZHVsZUlkXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBsaW5raW5nIG9vbG9uZyBmaWxlc1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbnRyeUZpbGVOYW1lXG4gICAgICovXG4gICAgbGluayhlbnRyeUZpbGVOYW1lKSB7XG4gICAgICAgIC8vY29tcGlsZSBlbnRyeSBmaWxlICAgICAgICBcbiAgICAgICAgbGV0IGVudHJ5TW9kdWxlID0gdGhpcy5sb2FkTW9kdWxlKGVudHJ5RmlsZU5hbWUpO1xuXG4gICAgICAgIGlmICghZW50cnlNb2R1bGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHJlc29sdmUgZmlsZSBcIiR7ZW50cnlGaWxlTmFtZX1cIi5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfLmlzRW1wdHkoZW50cnlNb2R1bGUuc2NoZW1hKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBzY2hlbWEgZGVmaW5lZCBpbiBlbnRyeSBmaWxlLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgXy5mb3JPd24oZW50cnlNb2R1bGUuc2NoZW1hLCAoc2NoZW1hSW5mbywgc2NoZW1hTmFtZSkgPT4ge1xuICAgICAgICAgICAgbGV0IHNjaGVtYSA9IG5ldyBTY2hlbWEodGhpcywgc2NoZW1hTmFtZSwgZW50cnlNb2R1bGUsIHNjaGVtYUluZm8pO1xuICAgICAgICAgICAgc2NoZW1hLmxpbmsoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2NoZW1hcy5oYXNPd25Qcm9wZXJ0eShzY2hlbWFOYW1lKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRHVwbGljYXRlIHNjaGVtYTogXCIke3NjaGVtYU5hbWV9XCIuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNjaGVtYXNbc2NoZW1hTmFtZV0gPSBzY2hlbWE7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNhdmVJbnRlcm1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICBsZXQganNGaWxlID0gcGF0aC5yZXNvbHZlKHRoaXMuc291cmNlUGF0aCwgZW50cnlGaWxlTmFtZSArICctbGlua2VkLmpzb24nKTtcbiAgICAgICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGpzRmlsZSwgSlNPTi5zdHJpbmdpZnkoc2NoZW1hLnRvSlNPTigpLCBudWxsLCA0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pOyAgICAgICAgXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCBhIG9vbG9uZyBtb2R1bGUsIHJldHVybiB1bmRlZmluZWQgaWYgbm90IGV4aXN0XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1vZHVsZVBhdGhcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBsb2FkTW9kdWxlKG1vZHVsZVBhdGgpIHsgICAgICAgIFxuICAgICAgICBtb2R1bGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuc291cmNlUGF0aCwgbW9kdWxlUGF0aCk7XG5cbiAgICAgICAgbGV0IGlkID0gdGhpcy5nZXRNb2R1bGVJZEJ5UGF0aChtb2R1bGVQYXRoKTtcblxuICAgICAgICBpZiAodGhpcy5pc01vZHVsZUxvYWRlZChpZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldE1vZHVsZUJ5SWQoaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKG1vZHVsZVBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG9vbCA9IHRoaXMuX2NvbXBpbGUobW9kdWxlUGF0aCk7XG5cbiAgICAgICAgcmV0dXJuICh0aGlzLl9vb2xNb2R1bGVzW2lkXSA9IG9vbCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVHJhY2sgYmFjayB0aGUgdHlwZSBkZXJpdmVkIGNoYWluLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvb2xNb2R1bGVcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gaW5mb1xuICAgICAqIEByZXR1cm5zIHtvYmplY3R9XG4gICAgICovXG4gICAgdHJhY2tCYWNrVHlwZShvb2xNb2R1bGUsIGluZm8pIHtcbiAgICAgICAgaWYgKFR5cGVzLkJ1aWx0aW4uaGFzKGluZm8udHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGJhc2VJbmZvID0gdGhpcy5sb2FkRWxlbWVudChvb2xNb2R1bGUsIE9vbFR5cGVzLkVsZW1lbnQuVFlQRSwgaW5mby50eXBlKTtcblxuICAgICAgICBpZiAoIVR5cGVzLkJ1aWx0aW4uaGFzKGJhc2VJbmZvLnR5cGUpKSB7XG4gICAgICAgICAgICAvL3RoZSBiYXNlIHR5cGUgaXMgbm90IGEgYnVpbHRpbiB0eXBlXG4gICAgICAgICAgICBsZXQgdW5pcXVlSWQgPSB0aGlzLmdldEVsZW1lbnRVbmlxdWVJZChvb2xNb2R1bGUsIE9vbFR5cGVzLkVsZW1lbnQuVFlQRSwgdmFsdWUubmFtZSk7XG4gICAgICAgICAgICBsZXQgb3duZXJNb2R1bGUgPSB0aGlzLmdldE1vZHVsZUJ5SWQodGhpcy5fbWFwT2ZSZWZlcmVuY2VUb01vZHVsZUlkLmdldCh1bmlxdWVJZCkpO1xuICAgICAgICAgICAgbGV0IHJvb3RUeXBlSW5mbyA9IHRoaXMudHJhY2tCYWNrVHlwZShvd25lck1vZHVsZSwgYmFzZUluZm8pO1xuICAgICAgICAgICAgb3duZXJNb2R1bGUudHlwZVtiYXNlSW5mby50eXBlXSA9IHJvb3RUeXBlSW5mbztcbiAgICAgICAgICAgIGJhc2VJbmZvID0gcm9vdFR5cGVJbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGRlcml2ZWRJbmZvID0geyAuLi5fLmNsb25lRGVlcChfLm9taXQoYmFzZUluZm8sIFsnbW9kaWZpZXJzJ10pKSwgLi4uXy5vbWl0KGluZm8sIFsndHlwZScsICdtb2RpZmllcnMnXSl9O1xuICAgICAgICBpZiAoYmFzZUluZm8ubW9kaWZpZXJzIHx8IGluZm8ubW9kaWZpZXJzKSB7XG4gICAgICAgICAgICBkZXJpdmVkSW5mby5tb2RpZmllcnMgPSBbIC4uLihiYXNlSW5mby5tb2RpZmllcnMgfHwgW10pLCAuLi4oaW5mby5tb2RpZmllcnMgfHwgW10pIF07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRlcml2ZWRJbmZvLnN1YkNsYXNzKSB7XG4gICAgICAgICAgICBkZXJpdmVkSW5mby5zdWJDbGFzcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGRlcml2ZWRJbmZvLnN1YkNsYXNzLnB1c2goaW5mby50eXBlKTtcbiAgICAgICAgcmV0dXJuIGRlcml2ZWRJbmZvO1xuICAgIH0gICAgXG4gICAgXG4gICAgLyoqXG4gICAgICogVHJhbnNsYXRlIGFuIHZhbHVlIGJ5IGluZmVycmluZyBhbGwgdGhlIHJlZmVyZW5jZXMuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG9vbE1vZHVsZSBcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlIFxuICAgICAqIEByZXR1cm5zIHsqfSAtIFRyYW5zbGF0ZWQgdmFsdWUuXG4gICAgICovXG4gICAgdHJhbnNsYXRlT29sVmFsdWUob29sTW9kdWxlLCB2YWx1ZSkge1xuICAgICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLm9vbFR5cGUgPT09IE9vbFR5cGVzLkxhbmcuQ09OU1RfUkVGKSB7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGxldCByZWZlZFZhbHVlID0gdGhpcy5sb2FkRWxlbWVudChvb2xNb2R1bGUsIE9vbFR5cGVzLkVsZW1lbnQuQ09OU1QsIHZhbHVlLm5hbWUpO1xuICAgICAgICAgICAgICAgIGxldCB1bmlxdWVJZCA9IHRoaXMuZ2V0RWxlbWVudFVuaXF1ZUlkKG9vbE1vZHVsZSwgT29sVHlwZXMuRWxlbWVudC5DT05TVCwgdmFsdWUubmFtZSk7XG4gICAgICAgICAgICAgICAgbGV0IG93bmVyTW9kdWxlID0gdGhpcy5nZXRNb2R1bGVCeUlkKHRoaXMuX21hcE9mUmVmZXJlbmNlVG9Nb2R1bGVJZC5nZXQodW5pcXVlSWQpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50cmFuc2xhdGVPb2xWYWx1ZShvd25lck1vZHVsZSwgcmVmZWRWYWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLm9vbFR5cGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHRvZG86IHRyYW5zbGF0ZU9vbFZhbHVlIHdpdGggdHlwZTogJHt2YWx1ZS5vb2xUeXBlfWApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBfLm1hcFZhbHVlcyh2YWx1ZSwgdiA9PiB0aGlzLnRyYW5zbGF0ZU9vbFZhbHVlKG9vbE1vZHVsZSwgdikpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUubWFwKHYgPT4gdGhpcy50cmFuc2xhdGVPb2xWYWx1ZShvb2xNb2R1bGUsIHYpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHVuaXF1ZSBtb2R1bGUgaWQgYnkgc291cmNlIGZpbGUgcGF0aC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kdWxlUGF0aCAtIFRoZSBwYXRoIG9mIGFuIG9vbG9uZyBzb3VyY2UgZmlsZS5cbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRoZSBtb2R1bGUgaWQuXG4gICAgICovXG4gICAgZ2V0TW9kdWxlSWRCeVBhdGgobW9kdWxlUGF0aCkgeyAgICAgICAgXG4gICAgICAgIGxldCBpc0J1aWx0aW5FbnRpdHkgPSBfLnN0YXJ0c1dpdGgobW9kdWxlUGF0aCwgQlVJTFRJTlNfUEFUSCk7ICAgICAgXG4gICAgICAgIHJldHVybiBpc0J1aWx0aW5FbnRpdHkgPyBcbiAgICAgICAgICAgIHBhdGgucmVsYXRpdmUoQlVJTFRJTlNfUEFUSCwgbW9kdWxlUGF0aCkgOiBcbiAgICAgICAgICAgICcuLycgKyBwYXRoLnJlbGF0aXZlKHRoaXMuc291cmNlUGF0aCwgbW9kdWxlUGF0aCk7ICBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHVuaXF1ZSBuYW1lIG9mIGFuIGVsZW1lbnQuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHJlZmVyZXJNb2R1bGUgXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRUeXBlIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50TmFtZSBcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRoZSB1bmlxdWUgbmFtZSBvZiBhbiBlbGVtZW50LlxuICAgICAqL1xuICAgIGdldEVsZW1lbnRVbmlxdWVJZChyZWZlcmVyTW9kdWxlLCBlbGVtZW50VHlwZSwgZWxlbWVudE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRUeXBlICsgJzonICsgZWxlbWVudE5hbWUgKyAnPC0nICsgcmVmZXJlck1vZHVsZS5pZDtcbiAgICB9XG5cbiAgICBsb2FkRW50aXR5KHJlZmVyZXJNb2R1bGUsIGVsZW1lbnROYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRFbGVtZW50KHJlZmVyZXJNb2R1bGUsIE9vbFR5cGVzLkVsZW1lbnQuRU5USVRZLCBlbGVtZW50TmFtZSk7XG4gICAgfVxuXG4gICAgbG9hZFR5cGUocmVmZXJlck1vZHVsZSwgZWxlbWVudE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZEVsZW1lbnQocmVmZXJlck1vZHVsZSwgT29sVHlwZXMuRWxlbWVudC5UWVBFLCBlbGVtZW50TmFtZSk7XG4gICAgfVxuXG4gICAgbG9hZERhdGFzZXQocmVmZXJlck1vZHVsZSwgZWxlbWVudE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZEVsZW1lbnQocmVmZXJlck1vZHVsZSwgT29sVHlwZXMuRWxlbWVudC5EQVRBU0VULCBlbGVtZW50TmFtZSk7XG4gICAgfVxuXG4gICAgbG9hZFZpZXcocmVmZXJlck1vZHVsZSwgZWxlbWVudE5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZEVsZW1lbnQocmVmZXJlck1vZHVsZSwgT29sVHlwZXMuRWxlbWVudC5WSUVXLCBlbGVtZW50TmFtZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCBhbiBlbGVtZW50IGJhc2VkIG9uIHRoZSBuYW1lc3BhY2UgY2hhaW4uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHJlZmVyZXJNb2R1bGUgXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRUeXBlIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50TmFtZSBcbiAgICAgKi9cbiAgICBsb2FkRWxlbWVudChyZWZlcmVyTW9kdWxlLCBlbGVtZW50VHlwZSwgZWxlbWVudE5hbWUpIHtcbiAgICAgICAgLy8gdGhlIGVsZW1lbnQgaWQgd2l0aCB0eXBlLCBzaG91bGQgYmUgdW5pcXVlIGFtb25nIHRoZSB3aG9sZSBzY2hlbWFcbiAgICAgICAgbGV0IHVuaXF1ZUlkID0gdGhpcy5nZXRFbGVtZW50VW5pcXVlSWQocmVmZXJlck1vZHVsZSwgZWxlbWVudFR5cGUsIGVsZW1lbnROYW1lKTtcblxuICAgICAgICAvLyB0aGUgZWxlbWVudCBpZCArIHJlZmVyZXJcbiAgICAgICAgaWYgKHVuaXF1ZUlkIGluIHRoaXMuX2VsZW1lbnRzQ2FjaGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50c0NhY2hlW3VuaXF1ZUlkXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0YXJnZXRNb2R1bGU7ICAgICAgICBcblxuICAgICAgICBpZiAoZWxlbWVudFR5cGUgaW4gcmVmZXJlck1vZHVsZSAmJiBlbGVtZW50TmFtZSBpbiByZWZlcmVyTW9kdWxlW2VsZW1lbnRUeXBlXSkge1xuICAgICAgICAgICAgLy8gc2VlIGlmIGl0IGV4aXN0cyBpbiB0aGUgc2FtZSBtb2R1bGUgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHRhcmdldE1vZHVsZSA9IHJlZmVyZXJNb2R1bGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzZWFyY2ggcmV2ZXJzZWx5IGJ5IHRoZSBuYW1lc3BhY2VzXG4gICAgICAgICAgICB0aGlzLmxvZygndmVyYm9zZScsIGBTZWFyY2hpbmcgJHtlbGVtZW50VHlwZX0gXCIke2VsZW1lbnROYW1lfVwiIGZyb20gXCIke3JlZmVyZXJNb2R1bGUuaWR9XCIgLi4uYCk7XG5cbiAgICAgICAgICAgIGxldCBpbmRleCA9IF8uZmluZExhc3RJbmRleChyZWZlcmVyTW9kdWxlLm5hbWVzcGFjZSwgbW9kdWxlUGF0aCA9PiB7XG4gICAgICAgICAgICAgICAgLy90aGlzLmxvZygnZGVidWcnLCBgTG9va2luZyBmb3IgJHtlbGVtZW50VHlwZX0gXCIke2VsZW1lbnROYW1lfVwiIGluIFwiJHttb2R1bGVQYXRofVwiIC4uLmApO1xuXG4gICAgICAgICAgICAgICAgdGFyZ2V0TW9kdWxlID0gdGhpcy5sb2FkTW9kdWxlKG1vZHVsZVBhdGgpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldE1vZHVsZSAmJiB0YXJnZXRNb2R1bGVbZWxlbWVudFR5cGVdICYmIChlbGVtZW50TmFtZSBpbiB0YXJnZXRNb2R1bGVbZWxlbWVudFR5cGVdKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtlbGVtZW50VHlwZX0gXCIke2VsZW1lbnROYW1lfVwiIG5vdCBmb3VuZCBpbiBpbXBvcnRlZCBuYW1lc3BhY2VzLiBSZWZlcmVyOiAke3JlZmVyZXJNb2R1bGUuaWR9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxvZygndmVyYm9zZScsIGBGb3VuZCAke2VsZW1lbnRUeXBlfSBcIiR7ZWxlbWVudE5hbWV9XCIgaW4gXCIke3RhcmdldE1vZHVsZS5pZH1cIi4gW09LXWApO1xuXG4gICAgICAgIGxldCBlbGVtZW50U2VsZklkID0gZWxlbWVudFR5cGUgKyAnOicgKyBlbGVtZW50TmFtZSArICdAJyArIHRhcmdldE1vZHVsZS5pZDtcbiAgICAgICAgaWYgKGVsZW1lbnRTZWxmSWQgaW4gdGhpcy5fZWxlbWVudHNDYWNoZSkge1xuICAgICAgICAgICAgLy8gYWxyZWFkeSBpbml0aWFsaXplZCAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9lbGVtZW50c0NhY2hlW3VuaXF1ZUlkXSA9IHRoaXMuX2VsZW1lbnRzQ2FjaGVbZWxlbWVudFNlbGZJZF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYXNzZXJ0IG5hbWluZyB2YWxpZGF0eVxuICAgICAgICBhc3NlcnQ6ICF0aGlzLl9tYXBPZlJlZmVyZW5jZVRvTW9kdWxlSWQuaGFzKHVuaXF1ZUlkKSwgYCR7ZWxlbWVudFR5cGV9IFwiJHtlbGVtZW50TmFtZX1cIiBpbiBcIiR7dGFyZ2V0TW9kdWxlLmlkfVwiIGNvbmZsaWN0cyB3aXRoICR7ZWxlbWVudFR5cGV9IGluIFwiJHt0aGlzLl9tYXBPZlJlZmVyZW5jZVRvTW9kdWxlSWQuZ2V0KHVuaXF1ZUlkKX1cIiFgO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5fbWFwT2ZSZWZlcmVuY2VUb01vZHVsZUlkLnNldCh1bmlxdWVJZCwgdGFyZ2V0TW9kdWxlLmlkKTtcblxuICAgICAgICAvLyByZXRyaWV2ZSB0aGUgY29tcGlsZWQgaW5mb1xuICAgICAgICBsZXQgZWxlbWVudEluZm8gPSBPYmplY3QuZnJlZXplKHRhcmdldE1vZHVsZVtlbGVtZW50VHlwZV1bZWxlbWVudE5hbWVdKTtcbiAgICAgICAgbGV0IGVsZW1lbnQ7XG5cbiAgICAgICAgaWYgKGVsZW1lbnRUeXBlIGluIEVMRU1FTlRfQ0xBU1NfTUFQKSB7XG4gICAgICAgICAgICAvLyBlbGVtZW50IG5lZWQgbGlua2luZ1xuICAgICAgICAgICAgbGV0IEVsZW1lbnRDbGFzcyA9IEVMRU1FTlRfQ0xBU1NfTUFQW2VsZW1lbnRUeXBlXTtcbiAgICAgICAgICAgIGVsZW1lbnQgPSBuZXcgRWxlbWVudENsYXNzKHRoaXMsIGVsZW1lbnROYW1lLCB0YXJnZXRNb2R1bGUsIGVsZW1lbnRJbmZvKTsgICBcbiAgICAgICAgICAgIGVsZW1lbnQubGluaygpOyAgICAgICAgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnRJbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZWxlbWVudHNDYWNoZVtlbGVtZW50U2VsZklkXSA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRzQ2FjaGVbdW5pcXVlSWRdID0gZWxlbWVudDtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cblxuICAgIF9jb21waWxlKG9vbEZpbGUpIHtcbiAgICAgICAgbGV0IGpzRmlsZTtcbiAgICAgICAgXG4gICAgICAgIGlmIChvb2xGaWxlLmVuZHNXaXRoKCcuanNvbicpKSB7XG4gICAgICAgICAgICBqc0ZpbGUgPSBvb2xGaWxlO1xuICAgICAgICAgICAgb29sRmlsZSA9IG9vbEZpbGUuc3Vic3RyKDAsIG9vbEZpbGUubGVuZ3RoIC0gNSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBqc0ZpbGUgPSBvb2xGaWxlICsgJy5qc29uJztcbiAgICAgICAgfSAgICAgICAgICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGxldCBvb2wsIHNlYXJjaEV4dDtcblxuICAgICAgICBpZiAodGhpcy51c2VKc29uU291cmNlKSB7XG4gICAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoanNGaWxlKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgXCJ1c2VKc29uU291cmNlXCIgZW5hYmVsZCBidXQganNvbiBmaWxlIFwiJHtqc0ZpbGV9XCIgbm90IGZvdW5kLmApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvb2wgPSBmcy5yZWFkSnNvblN5bmMoanNGaWxlKTtcbiAgICAgICAgICAgIHNlYXJjaEV4dCA9IE9PTE9OR19TT1VSQ0VfRVhUICsgJy5qc29uJztcbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgdGhpcy5sb2coJ2RlYnVnJywgJ0NvbXBpbGluZyAnICsgb29sRmlsZSArICcgLi4uJyk7ICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBvb2wgPSBPb2xvbmdQYXJzZXIucGFyc2UoZnMucmVhZEZpbGVTeW5jKG9vbEZpbGUsICd1dGY4JykpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjb21waWxlIFwiJHsgb29sRmlsZSB9XCIuXFxuJHsgZXJyb3IubWVzc2FnZSB8fCBlcnJvciB9YClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFvb2wpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3Igb2NjdXJyZWQgd2hpbGUgY29tcGlsaW5nLicpO1xuICAgICAgICAgICAgfSAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc2VhcmNoRXh0ID0gT09MT05HX1NPVVJDRV9FWFQ7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYmFzZU5hbWUgPSBwYXRoLmJhc2VuYW1lKG9vbEZpbGUsIE9PTE9OR19TT1VSQ0VfRVhUKTtcblxuICAgICAgICBsZXQgbmFtZXNwYWNlID0gW107XG5cbiAgICAgICAgbGV0IGN1cnJlbnRQYXRoID0gcGF0aC5kaXJuYW1lKG9vbEZpbGUpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBcbiAgICAgICAgICogQHBhcmFtIHsqfSBuYW1lc3BhY2VzIC0gU2VhcmNoaW5nIHBhdGhcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5zIC0gSW1wb3J0IGxpbmVcbiAgICAgICAgICogQHBhcmFtIHsqfSByZWN1cnNpdmUgXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBleHBhbmROcyhuYW1lc3BhY2VzLCBucywgcmVjdXJzaXZlKSB7XG4gICAgICAgICAgICBsZXQgc3RhdHMgPSBmcy5zdGF0U3luYyhucyk7XG5cbiAgICAgICAgICAgIC8vaW1wb3J0ICcvcGF0aC91c2VyLm9vbCdcbiAgICAgICAgICAgIGlmIChzdGF0cy5pc0ZpbGUoKSAmJiBucy5lbmRzV2l0aChzZWFyY2hFeHQpKSB7XG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlcy5wdXNoKG5zKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzdGF0cy5pc0RpcmVjdG9yeSgpICYmIHJlY3Vyc2l2ZSkge1xuICAgICAgICAgICAgICAgIC8vcmVzdXJzaXZlIGV4cGFuZCBzdWItZGlyZWN0b3J5XG4gICAgICAgICAgICAgICAgbGV0IGZpbGVzID0gZnMucmVhZGRpclN5bmMobnMpO1xuICAgICAgICAgICAgICAgIGZpbGVzLmZvckVhY2goZiA9PiBleHBhbmROcyhuYW1lc3BhY2VzLCBwYXRoLmpvaW4obnMsIGYpLCB0cnVlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob29sLm5hbWVzcGFjZSkge1xuICAgICAgICAgICAgb29sLm5hbWVzcGFjZS5mb3JFYWNoKG5zID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAobnMuc3RhcnRzV2l0aCgnPG9vbG9uZz4vJykpIHtcbiAgICAgICAgICAgICAgICAgICAgbnMgPSBwYXRoLmpvaW4oQlVJTFRJTlNfUEFUSCwgbnMuc3Vic3RyKDkpKTsgICBcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5zLnN0YXJ0c1dpdGgoJzxzb3VyY2U+LycpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5zID0gcGF0aC5qb2luKHRoaXMuc291cmNlUGF0aCwgbnMuc3Vic3RyKDkpKTsgICBcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICBpZiAobnMuZW5kc1dpdGgoJy8qJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcCA9IHBhdGgucmVzb2x2ZShjdXJyZW50UGF0aCwgbnMuc3Vic3RyKDAsIG5zLmxlbmd0aCAtIDIpKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZpbGVzID0gZnMucmVhZGRpclN5bmMocCk7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLmZvckVhY2goZiA9PiBleHBhbmROcyhuYW1lc3BhY2UsIHBhdGguam9pbihwLCBmKSwgZmFsc2UpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5zLmVuZHNXaXRoKCcvKionKSkge1xuICAgICAgICAgICAgICAgICAgICBwID0gcGF0aC5yZXNvbHZlKGN1cnJlbnRQYXRoLCBucy5zdWJzdHIoMCwgbnMubGVuZ3RoIC0gMykpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhwKTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmID0+IGV4cGFuZE5zKG5hbWVzcGFjZSwgcGF0aC5qb2luKHAsIGYpLCB0cnVlKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZXNwYWNlLnB1c2gocGF0aC5yZXNvbHZlKGN1cnJlbnRQYXRoLCBfLmVuZHNXaXRoKG5zLCBPT0xPTkdfU09VUkNFX0VYVCkgPyBucyA6IG5zICsgT09MT05HX1NPVVJDRV9FWFQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9vbC5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7XG5cbiAgICAgICAgb29sLmlkID0gdGhpcy5nZXRNb2R1bGVJZEJ5UGF0aChvb2xGaWxlKTsgICAgICAgIFxuICAgICAgICBvb2wubmFtZSA9IGJhc2VOYW1lOyAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGlmICghdGhpcy51c2VKc29uU291cmNlICYmIHRoaXMuc2F2ZUludGVybWVkaWF0ZSkgeyAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGpzRmlsZSwgSlNPTi5zdHJpbmdpZnkob29sLCBudWxsLCA0KSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb29sO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBMaW5rZXI7Il19