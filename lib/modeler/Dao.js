"use strict";

require("source-map-support/register");

const path = require('path');

const {
  _,
  fs,
  pascalCase,
  replaceAll,
  putIntoBucket
} = require('rk-utils');

const swig = require('swig-templates');

const OolTypes = require('../lang/OolTypes');

const JsLang = require('./util/ast.js');

const OolToAst = require('./util/oolToAst.js');

const Snippets = require('./dao/snippets');

const ChainableType = [OolToAst.AST_BLK_VALIDATOR_CALL, OolToAst.AST_BLK_PROCESSOR_CALL, OolToAst.AST_BLK_ACTIVATOR_CALL];

const getFieldName = t => t.split('.').pop();

const isChainable = (current, next) => ChainableType.indexOf(current.type) > -1 && current.target === next.target && next.type === current.type;

const chainCall = (lastBlock, lastType, currentBlock, currentType) => {
  if (lastBlock) {
    if (lastType === 'ValidatorCall') {
      if (!(currentType === 'ValidatorCall')) {
        throw new Error('Unexpected currentType');
      }

      currentBlock = JsLang.astBinExp(lastBlock, '&&', currentBlock);
    } else {
      if (!(currentType === 'ProcessorCall')) {
        throw new Error('Unexpected currentType: ' + currentType + ' last: ' + lastType);
      }

      currentBlock.arguments[0] = lastBlock;
    }
  }

  return currentBlock;
};

const asyncMethodNaming = name => name + '_';

const indentLines = (lines, indentation) => lines.split('\n').map((line, i) => i === 0 ? line : _.repeat(' ', indentation) + line).join('\n');

const OOL_MODIFIER_RETURN = {
  [OolTypes.Modifier.VALIDATOR]: () => [JsLang.astReturn(true)],
  [OolTypes.Modifier.PROCESSOR]: args => [JsLang.astReturn(JsLang.astId(args[0]))],
  [OolTypes.Modifier.ACTIVATOR]: () => [JsLang.astReturn(JsLang.astId("undefined"))]
};

class DaoModeler {
  constructor(context, connector) {
    this.logger = context.logger;
    this.outputPath = context.modelOutputPath;
    this.manifestPath = context.manifestOutputPath;
    this.connector = connector;
  }

  modeling_(schema) {
    this.logger.log('info', 'Generating entity models for schema "' + schema.name + '"...');

    this._generateSchemaModel(schema);

    this._generateEntityModel(schema);

    if (this.manifestPath) {
      this._generateEntityManifest(schema);
    }
  }

  _generateSchemaModel(schema) {
    let capitalized = pascalCase(schema.name);
    let locals = {
      driver: this.connector.driver,
      className: capitalized,
      schemaName: schema.name
    };
    let classTemplate = path.resolve(__dirname, 'database', this.connector.driver, 'Database.js.swig');
    let classCode = swig.renderFile(classTemplate, locals);
    let modelFilePath = path.resolve(this.outputPath, capitalized + '.js');
    fs.ensureFileSync(modelFilePath);
    fs.writeFileSync(modelFilePath, classCode);
    this.logger.log('info', 'Generated database model: ' + modelFilePath);
  }

  _generateEntityModel(schema) {
    _.forOwn(schema.entities, (entity, entityInstanceName) => {
      let capitalized = pascalCase(entityInstanceName);
      let sharedContext = {
        mapOfFunctorToFile: {},
        newFunctorFiles: []
      };

      let {
        ast: astClassMain,
        fieldReferences
      } = this._processFieldModifiers(entity, sharedContext);

      astClassMain = [astClassMain];
      let uniqueKeys = [_.castArray(entity.key)];

      if (entity.indexes) {
        entity.indexes.forEach(index => {
          if (index.unique) {
            uniqueKeys.push(index.fields);
          }
        });
      }

      let modelMeta = {
        schemaName: schema.name,
        name: entityInstanceName,
        keyField: entity.key,
        fields: _.mapValues(entity.fields, f => _.omit(f.toJSON(), 'modifiers')),
        features: entity.features || {},
        uniqueKeys
      };

      if (!_.isEmpty(entity.indexes)) {
        modelMeta.indexes = entity.indexes;
      }

      if (!_.isEmpty(entity.features)) {
        modelMeta.features = entity.features;
      }

      if (!_.isEmpty(entity.associations)) {
        modelMeta.associations = entity.associations;
      }

      if (!_.isEmpty(fieldReferences)) {
        modelMeta.fieldDependencies = fieldReferences;
      }

      if (entity.interfaces) {
        let astInterfaces = this._buildInterfaces(entity, modelMeta, sharedContext);

        astClassMain = astClassMain.concat(astInterfaces);
      }

      let importLines = [];

      if (!_.isEmpty(sharedContext.mapOfFunctorToFile)) {
        _.forOwn(sharedContext.mapOfFunctorToFile, (fileName, functionName) => {
          importLines.push(JsLang.astToCode(JsLang.astRequire(functionName, fileName)));
        });
      }

      if (!_.isEmpty(sharedContext.newFunctorFiles)) {
        _.each(sharedContext.newFunctorFiles, entry => {
          this._generateFunctionTemplateFile(schema, entry);
        });
      }

      let mixins = [];

      if (!_.isEmpty(entity.info.mixins)) {
        let mixinsDirPath = path.resolve(this.outputPath, schema.name, 'mixins');
        fs.ensureDirSync(mixinsDirPath);
        entity.info.mixins.forEach(m => {
          let mixinName = pascalCase(m);
          let mixinFilePath = path.join(mixinsDirPath, mixinName + '.js');

          if (!fs.pathExistsSync(mixinFilePath)) {
            fs.writeFileSync(mixinFilePath, "throw new Error('to be implemented...')");
          }

          let mixinVarName = 'mixin' + mixinName;
          importLines.push(JsLang.astToCode(JsLang.astRequire(mixinVarName, './mixins/' + mixinName)));
          mixins.push(mixinVarName);
        });
      }

      let locals = {
        imports: importLines.join('\n'),
        className: capitalized,
        entityMeta: indentLines(JSON.stringify(modelMeta, null, 4), 4),
        classBody: indentLines(astClassMain.map(block => JsLang.astToCode(block)).join('\n\n'), 8),
        functors: indentLines(JsLang.astToCode(JsLang.astValue(_.reduce(sharedContext.newFunctorFiles, (result, functor) => {
          result['$' + functor.functionName] = JsLang.astId(functor.functionName);
          return result;
        }, {}))), 4),
        mixins
      };
      let classTemplate = path.resolve(__dirname, 'database', this.connector.driver, 'EntityModel.js.swig');
      let classCode = swig.renderFile(classTemplate, locals);
      let modelFilePath = path.resolve(this.outputPath, schema.name, capitalized + '.js');
      fs.ensureFileSync(modelFilePath);
      fs.writeFileSync(modelFilePath, classCode);
      this.logger.log('info', 'Generated entity model: ' + modelFilePath);
    });
  }

  _generateEntityManifest(schema) {
    let entities = Object.keys(schema.entities).sort().reduce((result, v) => {
      result[v] = {};
      return result;
    }, {});
    let outputFilePath = path.resolve(this.manifestPath, schema.name + '.manifest.json');
    fs.ensureFileSync(outputFilePath);
    fs.writeFileSync(outputFilePath, JSON.stringify(entities, null, 4));
    this.logger.log('info', 'Generated schema manifest: ' + outputFilePath);
  }

  _processFieldModifiers(entity, sharedContext) {
    let compileContext = OolToAst.createCompileContext(entity.oolModule.name, this.logger, sharedContext);
    compileContext.variables['raw'] = {
      source: 'context',
      finalized: true
    };
    compileContext.variables['i18n'] = {
      source: 'context',
      finalized: true
    };
    compileContext.variables['connector'] = {
      source: 'context',
      finalized: true
    };
    compileContext.variables['latest'] = {
      source: 'context'
    };
    const allFinished = OolToAst.createTopoId(compileContext, 'done.');
    let fieldReferences = {};

    _.forOwn(entity.fields, (field, fieldName) => {
      let topoId = OolToAst.compileField(fieldName, field, compileContext);
      OolToAst.dependsOn(compileContext, topoId, allFinished);

      if (field.writeOnce || field.freezeAfterNonDefault) {
        putIntoBucket(fieldReferences, fieldName, fieldName);
      }
    });

    let deps = compileContext.topoSort.sort();
    deps = deps.filter(dep => compileContext.mapOfTokenToMeta.has(dep));
    let methodBodyValidateAndFill = [],
        lastFieldsGroup,
        methodBodyCache = [],
        lastBlock,
        lastAstType;

    const _mergeDoValidateAndFillCode = function (fieldName, references, astCache, requireTargetField) {
      let fields = (requireTargetField ? [fieldName] : []).concat(references);
      let checker = fields.join(',');

      if (lastFieldsGroup && lastFieldsGroup.checker !== checker) {
        methodBodyValidateAndFill = methodBodyValidateAndFill.concat(Snippets._fieldRequirementCheck(lastFieldsGroup.fieldName, lastFieldsGroup.references, methodBodyCache, lastFieldsGroup.requireTargetField));
        methodBodyCache = [];
      }

      methodBodyCache = methodBodyCache.concat(astCache);
      lastFieldsGroup = {
        fieldName,
        references,
        requireTargetField,
        checker
      };
    };

    _.each(deps, (dep, i) => {
      let sourceMap = compileContext.mapOfTokenToMeta.get(dep);
      let astBlock = compileContext.astMap[dep];
      let targetFieldName = getFieldName(sourceMap.target);

      if (sourceMap.references) {
        let fieldReference = fieldReferences[targetFieldName];

        if (!fieldReference) {
          fieldReferences[targetFieldName] = fieldReference = [];
        }

        sourceMap.references.forEach(ref => {
          if (fieldReference.indexOf(ref) === -1) fieldReference.push(ref);
        });
      }

      if (lastBlock) {
        astBlock = chainCall(lastBlock, lastAstType, astBlock, sourceMap.type);
        lastBlock = undefined;
      }

      if (i < deps.length - 1) {
        let nextType = compileContext.mapOfTokenToMeta.get(deps[i + 1]);

        if (isChainable(sourceMap, nextType)) {
          lastBlock = astBlock;
          lastAstType = sourceMap.type;
          return;
        }
      }

      if (sourceMap.type === OolToAst.AST_BLK_VALIDATOR_CALL) {
        let astCache = Snippets._validateCheck(targetFieldName, astBlock);

        _mergeDoValidateAndFillCode(targetFieldName, sourceMap.references, astCache, true);
      } else if (sourceMap.type === OolToAst.AST_BLK_PROCESSOR_CALL) {
        let astCache = JsLang.astAssign(JsLang.astVarRef(sourceMap.target, true), astBlock, `Processing "${targetFieldName}"`);

        _mergeDoValidateAndFillCode(targetFieldName, sourceMap.references, astCache, true);
      } else if (sourceMap.type === OolToAst.AST_BLK_ACTIVATOR_CALL) {
        let astCache = JsLang.astAssign(JsLang.astVarRef(sourceMap.target, true), astBlock, `Activating "${targetFieldName}"`);

        _mergeDoValidateAndFillCode(targetFieldName, sourceMap.references, astCache, false);
      } else {
        throw new Error('To be implemented.');
      }
    });

    if (!_.isEmpty(methodBodyCache)) {
      methodBodyValidateAndFill = methodBodyValidateAndFill.concat(Snippets._fieldRequirementCheck(lastFieldsGroup.fieldName, lastFieldsGroup.references, methodBodyCache, lastFieldsGroup.requireTargetField));
    }

    return {
      ast: JsLang.astMemberMethod(asyncMethodNaming('applyModifiers'), ['context', 'isUpdating'], Snippets._applyModifiersHeader.concat(methodBodyValidateAndFill).concat([JsLang.astReturn(JsLang.astId('context'))]), false, true, true, 'Applying predefined modifiers to entity fields.'),
      fieldReferences
    };
  }

  _generateFunctionTemplateFile(schema, {
    functionName,
    functorType,
    fileName,
    args
  }) {
    let filePath = path.resolve(this.outputPath, schema.name, fileName);

    if (fs.existsSync(filePath)) {
      this.logger.log('info', `${_.upperFirst(functorType)} "${fileName}" exists. File generating skipped.`);
      return;
    }

    let ast = JsLang.astProgram();
    JsLang.astPushInBody(ast, JsLang.astFunction(functionName, args, OOL_MODIFIER_RETURN[functorType](args)));
    JsLang.astPushInBody(ast, JsLang.astAssign('module.exports', JsLang.astVarRef(functionName)));
    fs.ensureFileSync(filePath);
    fs.writeFileSync(filePath, JsLang.astToCode(ast));
    this.logger.log('info', `Generated ${functorType} file: ${filePath}`);
  }

  _buildInterfaces(entity, modelMetaInit, sharedContext) {
    let ast = [];

    _.forOwn(entity.interfaces, (method, name) => {
      this.logger.info('Building interface: ' + name);
      let astBody = [JsLang.astVarDeclare('$meta', JsLang.astVarRef('this.meta.interfaces.' + name), true, false, 'Retrieving the meta data')];
      let compileContext = OolToAst.createCompileContext(entity.oolModule.name, this.logger, sharedContext);
      let paramMeta;

      if (method.accept) {
        paramMeta = this._processParams(method.accept, compileContext);
      }

      modelMetaInit['interfaces'] || (modelMetaInit['interfaces'] = {});
      modelMetaInit['interfaces'][name] = {
        params: Object.values(paramMeta)
      };

      _.each(method.implementation, (operation, index) => {
        OolToAst.compileDbOperation(index, operation, compileContext, compileContext.mainStartId);
      });

      if (method.return) {
        OolToAst.compileExceptionalReturn(method.return, compileContext);
      }

      let deps = compileContext.topoSort.sort();
      deps = deps.filter(dep => compileContext.mapOfTokenToMeta.has(dep));

      _.each(deps, dep => {
        let sourceMap = compileContext.mapOfTokenToMeta.get(dep);
        let astBlock = compileContext.astMap[dep];
        let targetFieldName = sourceMap.target;

        if (sourceMap.type === OolToAst.AST_BLK_VALIDATOR_CALL) {
          astBlock = Snippets._validateCheck(targetFieldName, astBlock);
        } else if (sourceMap.type === OolToAst.AST_BLK_PROCESSOR_CALL) {
          if (sourceMap.needDeclare) {
            astBlock = JsLang.astVarDeclare(JsLang.astVarRef(sourceMap.target), astBlock, false, false, `Processing "${targetFieldName}"`);
          } else {
            astBlock = JsLang.astAssign(JsLang.astVarRef(sourceMap.target, true), astBlock, `Processing "${targetFieldName}"`);
          }
        } else if (sourceMap.type === OolToAst.AST_BLK_ACTIVATOR_CALL) {
          if (sourceMap.needDeclare) {
            astBlock = JsLang.astVarDeclare(JsLang.astVarRef(sourceMap.target), astBlock, false, false, `Processing "${targetFieldName}"`);
          } else {
            astBlock = JsLang.astAssign(JsLang.astVarRef(sourceMap.target, true), astBlock, `Activating "${targetFieldName}"`);
          }
        }

        astBody = astBody.concat(_.castArray(astBlock));
      });

      ast.push(JsLang.astMemberMethod(asyncMethodNaming(name), Object.keys(paramMeta), astBody, false, true, true, replaceAll(_.kebabCase(name), '-', ' ')));
    });

    return ast;
  }

  _processParams(acceptParams, compileContext) {
    let paramMeta = {};
    acceptParams.forEach((param, i) => {
      OolToAst.compileParam(i, param, compileContext);
      paramMeta[param.name] = param;
      compileContext.variables[param.name] = {
        source: 'argument'
      };
    });
    return paramMeta;
  }

}

module.exports = DaoModeler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbGVyL0Rhby5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsIl8iLCJmcyIsInBhc2NhbENhc2UiLCJyZXBsYWNlQWxsIiwicHV0SW50b0J1Y2tldCIsInN3aWciLCJPb2xUeXBlcyIsIkpzTGFuZyIsIk9vbFRvQXN0IiwiU25pcHBldHMiLCJDaGFpbmFibGVUeXBlIiwiQVNUX0JMS19WQUxJREFUT1JfQ0FMTCIsIkFTVF9CTEtfUFJPQ0VTU09SX0NBTEwiLCJBU1RfQkxLX0FDVElWQVRPUl9DQUxMIiwiZ2V0RmllbGROYW1lIiwidCIsInNwbGl0IiwicG9wIiwiaXNDaGFpbmFibGUiLCJjdXJyZW50IiwibmV4dCIsImluZGV4T2YiLCJ0eXBlIiwidGFyZ2V0IiwiY2hhaW5DYWxsIiwibGFzdEJsb2NrIiwibGFzdFR5cGUiLCJjdXJyZW50QmxvY2siLCJjdXJyZW50VHlwZSIsImFzdEJpbkV4cCIsImFyZ3VtZW50cyIsImFzeW5jTWV0aG9kTmFtaW5nIiwibmFtZSIsImluZGVudExpbmVzIiwibGluZXMiLCJpbmRlbnRhdGlvbiIsIm1hcCIsImxpbmUiLCJpIiwicmVwZWF0Iiwiam9pbiIsIk9PTF9NT0RJRklFUl9SRVRVUk4iLCJNb2RpZmllciIsIlZBTElEQVRPUiIsImFzdFJldHVybiIsIlBST0NFU1NPUiIsImFyZ3MiLCJhc3RJZCIsIkFDVElWQVRPUiIsIkRhb01vZGVsZXIiLCJjb25zdHJ1Y3RvciIsImNvbnRleHQiLCJjb25uZWN0b3IiLCJsb2dnZXIiLCJvdXRwdXRQYXRoIiwibW9kZWxPdXRwdXRQYXRoIiwibWFuaWZlc3RQYXRoIiwibWFuaWZlc3RPdXRwdXRQYXRoIiwibW9kZWxpbmdfIiwic2NoZW1hIiwibG9nIiwiX2dlbmVyYXRlU2NoZW1hTW9kZWwiLCJfZ2VuZXJhdGVFbnRpdHlNb2RlbCIsIl9nZW5lcmF0ZUVudGl0eU1hbmlmZXN0IiwiY2FwaXRhbGl6ZWQiLCJsb2NhbHMiLCJkcml2ZXIiLCJjbGFzc05hbWUiLCJzY2hlbWFOYW1lIiwiY2xhc3NUZW1wbGF0ZSIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJjbGFzc0NvZGUiLCJyZW5kZXJGaWxlIiwibW9kZWxGaWxlUGF0aCIsImVuc3VyZUZpbGVTeW5jIiwid3JpdGVGaWxlU3luYyIsImZvck93biIsImVudGl0aWVzIiwiZW50aXR5IiwiZW50aXR5SW5zdGFuY2VOYW1lIiwic2hhcmVkQ29udGV4dCIsIm1hcE9mRnVuY3RvclRvRmlsZSIsIm5ld0Z1bmN0b3JGaWxlcyIsImFzdCIsImFzdENsYXNzTWFpbiIsImZpZWxkUmVmZXJlbmNlcyIsIl9wcm9jZXNzRmllbGRNb2RpZmllcnMiLCJ1bmlxdWVLZXlzIiwiY2FzdEFycmF5Iiwia2V5IiwiaW5kZXhlcyIsImZvckVhY2giLCJpbmRleCIsInVuaXF1ZSIsInB1c2giLCJmaWVsZHMiLCJtb2RlbE1ldGEiLCJrZXlGaWVsZCIsIm1hcFZhbHVlcyIsImYiLCJvbWl0IiwidG9KU09OIiwiZmVhdHVyZXMiLCJpc0VtcHR5IiwiYXNzb2NpYXRpb25zIiwiZmllbGREZXBlbmRlbmNpZXMiLCJpbnRlcmZhY2VzIiwiYXN0SW50ZXJmYWNlcyIsIl9idWlsZEludGVyZmFjZXMiLCJjb25jYXQiLCJpbXBvcnRMaW5lcyIsImZpbGVOYW1lIiwiZnVuY3Rpb25OYW1lIiwiYXN0VG9Db2RlIiwiYXN0UmVxdWlyZSIsImVhY2giLCJlbnRyeSIsIl9nZW5lcmF0ZUZ1bmN0aW9uVGVtcGxhdGVGaWxlIiwibWl4aW5zIiwiaW5mbyIsIm1peGluc0RpclBhdGgiLCJlbnN1cmVEaXJTeW5jIiwibSIsIm1peGluTmFtZSIsIm1peGluRmlsZVBhdGgiLCJwYXRoRXhpc3RzU3luYyIsIm1peGluVmFyTmFtZSIsImltcG9ydHMiLCJlbnRpdHlNZXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsImNsYXNzQm9keSIsImJsb2NrIiwiZnVuY3RvcnMiLCJhc3RWYWx1ZSIsInJlZHVjZSIsInJlc3VsdCIsImZ1bmN0b3IiLCJPYmplY3QiLCJrZXlzIiwic29ydCIsInYiLCJvdXRwdXRGaWxlUGF0aCIsImNvbXBpbGVDb250ZXh0IiwiY3JlYXRlQ29tcGlsZUNvbnRleHQiLCJvb2xNb2R1bGUiLCJ2YXJpYWJsZXMiLCJzb3VyY2UiLCJmaW5hbGl6ZWQiLCJhbGxGaW5pc2hlZCIsImNyZWF0ZVRvcG9JZCIsImZpZWxkIiwiZmllbGROYW1lIiwidG9wb0lkIiwiY29tcGlsZUZpZWxkIiwiZGVwZW5kc09uIiwid3JpdGVPbmNlIiwiZnJlZXplQWZ0ZXJOb25EZWZhdWx0IiwiZGVwcyIsInRvcG9Tb3J0IiwiZmlsdGVyIiwiZGVwIiwibWFwT2ZUb2tlblRvTWV0YSIsImhhcyIsIm1ldGhvZEJvZHlWYWxpZGF0ZUFuZEZpbGwiLCJsYXN0RmllbGRzR3JvdXAiLCJtZXRob2RCb2R5Q2FjaGUiLCJsYXN0QXN0VHlwZSIsIl9tZXJnZURvVmFsaWRhdGVBbmRGaWxsQ29kZSIsInJlZmVyZW5jZXMiLCJhc3RDYWNoZSIsInJlcXVpcmVUYXJnZXRGaWVsZCIsImNoZWNrZXIiLCJfZmllbGRSZXF1aXJlbWVudENoZWNrIiwic291cmNlTWFwIiwiZ2V0IiwiYXN0QmxvY2siLCJhc3RNYXAiLCJ0YXJnZXRGaWVsZE5hbWUiLCJmaWVsZFJlZmVyZW5jZSIsInJlZiIsInVuZGVmaW5lZCIsImxlbmd0aCIsIm5leHRUeXBlIiwiX3ZhbGlkYXRlQ2hlY2siLCJhc3RBc3NpZ24iLCJhc3RWYXJSZWYiLCJFcnJvciIsImFzdE1lbWJlck1ldGhvZCIsIl9hcHBseU1vZGlmaWVyc0hlYWRlciIsImZ1bmN0b3JUeXBlIiwiZmlsZVBhdGgiLCJleGlzdHNTeW5jIiwidXBwZXJGaXJzdCIsImFzdFByb2dyYW0iLCJhc3RQdXNoSW5Cb2R5IiwiYXN0RnVuY3Rpb24iLCJtb2RlbE1ldGFJbml0IiwibWV0aG9kIiwiYXN0Qm9keSIsImFzdFZhckRlY2xhcmUiLCJwYXJhbU1ldGEiLCJhY2NlcHQiLCJfcHJvY2Vzc1BhcmFtcyIsInBhcmFtcyIsInZhbHVlcyIsImltcGxlbWVudGF0aW9uIiwib3BlcmF0aW9uIiwiY29tcGlsZURiT3BlcmF0aW9uIiwibWFpblN0YXJ0SWQiLCJyZXR1cm4iLCJjb21waWxlRXhjZXB0aW9uYWxSZXR1cm4iLCJuZWVkRGVjbGFyZSIsImtlYmFiQ2FzZSIsImFjY2VwdFBhcmFtcyIsInBhcmFtIiwiY29tcGlsZVBhcmFtIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU07QUFBRUMsRUFBQUEsQ0FBRjtBQUFLQyxFQUFBQSxFQUFMO0FBQVNDLEVBQUFBLFVBQVQ7QUFBcUJDLEVBQUFBLFVBQXJCO0FBQWlDQyxFQUFBQTtBQUFqQyxJQUFvREwsT0FBTyxDQUFDLFVBQUQsQ0FBakU7O0FBQ0EsTUFBTU0sSUFBSSxHQUFJTixPQUFPLENBQUMsZ0JBQUQsQ0FBckI7O0FBRUEsTUFBTU8sUUFBUSxHQUFHUCxPQUFPLENBQUMsa0JBQUQsQ0FBeEI7O0FBQ0EsTUFBTVEsTUFBTSxHQUFHUixPQUFPLENBQUMsZUFBRCxDQUF0Qjs7QUFDQSxNQUFNUyxRQUFRLEdBQUdULE9BQU8sQ0FBQyxvQkFBRCxDQUF4Qjs7QUFDQSxNQUFNVSxRQUFRLEdBQUdWLE9BQU8sQ0FBQyxnQkFBRCxDQUF4Qjs7QUFFQSxNQUFNVyxhQUFhLEdBQUcsQ0FDbEJGLFFBQVEsQ0FBQ0csc0JBRFMsRUFFbEJILFFBQVEsQ0FBQ0ksc0JBRlMsRUFHbEJKLFFBQVEsQ0FBQ0ssc0JBSFMsQ0FBdEI7O0FBTUEsTUFBTUMsWUFBWSxHQUFHQyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsS0FBRixDQUFRLEdBQVIsRUFBYUMsR0FBYixFQUExQjs7QUFDQSxNQUFNQyxXQUFXLEdBQUcsQ0FBQ0MsT0FBRCxFQUFVQyxJQUFWLEtBQW1CVixhQUFhLENBQUNXLE9BQWQsQ0FBc0JGLE9BQU8sQ0FBQ0csSUFBOUIsSUFBc0MsQ0FBQyxDQUF2QyxJQUNoQ0gsT0FBTyxDQUFDSSxNQUFSLEtBQW1C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LENBQUMxRixNQUFSLENBQWU5RyxDQUFDLENBQUN5RixTQUFGLENBQVl3RixRQUFaLENBQWYsQ0FBVjtBQUNILE9BM0JEOztBQTZCQTdGLE1BQUFBLEdBQUcsQ0FBQ1csSUFBSixDQUFTeEYsTUFBTSxDQUFDc0wsZUFBUCxDQUF1QjlKLGlCQUFpQixDQUFDQyxJQUFELENBQXhDLEVBQWdEMkcsTUFBTSxDQUFDQyxJQUFQLENBQVk4RCxTQUFaLENBQWhELEVBQXdFRixPQUF4RSxFQUFpRixLQUFqRixFQUF3RixJQUF4RixFQUE4RixJQUE5RixFQUFvR3JNLFVBQVUsQ0FBQ0gsQ0FBQyxDQUFDc04sU0FBRixDQUFZdEwsSUFBWixDQUFELEVBQW9CLEdBQXBCLEVBQXlCLEdBQXpCLENBQTlHLENBQVQ7QUFDSCxLQWhFRDs7QUFrRUEsV0FBT29ELEdBQVA7QUFDSDs7QUFFRHdILEVBQUFBLGNBQWMsQ0FBQ1csWUFBRCxFQUFldkUsY0FBZixFQUErQjtBQUN6QyxRQUFJMEQsU0FBUyxHQUFHLEVBQWhCO0FBRUFhLElBQUFBLFlBQVksQ0FBQzNILE9BQWIsQ0FBcUIsQ0FBQzRILEtBQUQsRUFBUWxMLENBQVIsS0FBYztBQUMvQjlCLE1BQUFBLFFBQVEsQ0FBQ2lOLFlBQVQsQ0FBc0JuTCxDQUF0QixFQUF5QmtMLEtBQXpCLEVBQWdDeEUsY0FBaEM7QUFDQTBELE1BQUFBLFNBQVMsQ0FBQ2MsS0FBSyxDQUFDeEwsSUFBUCxDQUFULEdBQXdCd0wsS0FBeEI7QUFDQXhFLE1BQUFBLGNBQWMsQ0FBQ0csU0FBZixDQUF5QnFFLEtBQUssQ0FBQ3hMLElBQS9CLElBQXVDO0FBQUVvSCxRQUFBQSxNQUFNLEVBQUU7QUFBVixPQUF2QztBQUNILEtBSkQ7QUFNQSxXQUFPc0QsU0FBUDtBQUNIOztBQTdnQlk7O0FBZ2hCakJnQixNQUFNLENBQUNDLE9BQVAsR0FBaUIxSyxVQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBfLCBmcywgcGFzY2FsQ2FzZSwgcmVwbGFjZUFsbCwgcHV0SW50b0J1Y2tldCB9ICA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5jb25zdCBzd2lnICA9IHJlcXVpcmUoJ3N3aWctdGVtcGxhdGVzJyk7XG5cbmNvbnN0IE9vbFR5cGVzID0gcmVxdWlyZSgnLi4vbGFuZy9Pb2xUeXBlcycpO1xuY29uc3QgSnNMYW5nID0gcmVxdWlyZSgnLi91dGlsL2FzdC5qcycpO1xuY29uc3QgT29sVG9Bc3QgPSByZXF1aXJlKCcuL3V0aWwvb29sVG9Bc3QuanMnKTtcbmNvbnN0IFNuaXBwZXRzID0gcmVxdWlyZSgnLi9kYW8vc25pcHBldHMnKTtcblxuY29uc3QgQ2hhaW5hYmxlVHlwZSA9IFtcbiAgICBPb2xUb0FzdC5BU1RfQkxLX1ZBTElEQVRPUl9DQUxMLCBcbiAgICBPb2xUb0FzdC5BU1RfQkxLX1BST0NFU1NPUl9DQUxMLFxuICAgIE9vbFRvQXN0LkFTVF9CTEtfQUNUSVZBVE9SX0NBTExcbl07XG5cbmNvbnN0IGdldEZpZWxkTmFtZSA9IHQgPT4gdC5zcGxpdCgnLicpLnBvcCgpO1xuY29uc3QgaXNDaGFpbmFibGUgPSAoY3VycmVudCwgbmV4dCkgPT4gQ2hhaW5hYmxlVHlwZS5pbmRleE9mKGN1cnJlbnQudHlwZSkgPiAtMVxuICAgICYmIGN1cnJlbnQudGFyZ2V0ID09PSBuZXh0LnRhcmdldFxuICAgICYmIG5leHQudHlwZSA9PT0gY3VycmVudC50eXBlO1xuY29uc3QgY2hhaW5DYWxsID0gKGxhc3RCbG9jaywgbGFzdFR5cGUsIGN1cnJlbnRCbG9jaywgY3VycmVudFR5cGUpID0+IHtcbiAgICBpZiAobGFzdEJsb2NrKSB7XG4gICAgICAgIGlmIChsYXN0VHlwZSA9PT0gJ1ZhbGlkYXRvckNhbGwnKSB7XG4gICAgICAgICAgICBhc3NlcnQ6IGN1cnJlbnRUeXBlID09PSAnVmFsaWRhdG9yQ2FsbCcsICdVbmV4cGVjdGVkIGN1cnJlbnRUeXBlJztcblxuICAgICAgICAgICAgY3VycmVudEJsb2NrID0gSnNMYW5nLmFzdEJpbkV4cChsYXN0QmxvY2ssICcmJicsIGN1cnJlbnRCbG9jayk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhc3NlcnQ6IGN1cnJlbnRUeXBlID09PSAnUHJvY2Vzc29yQ2FsbCcsICdVbmV4cGVjdGVkIGN1cnJlbnRUeXBlOiAnICsgY3VycmVudFR5cGUgKyAnIGxhc3Q6ICcgKyBsYXN0VHlwZTtcblxuICAgICAgICAgICAgY3VycmVudEJsb2NrLmFyZ3VtZW50c1swXSA9IGxhc3RCbG9jaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjdXJyZW50QmxvY2s7XG59O1xuY29uc3QgYXN5bmNNZXRob2ROYW1pbmcgPSAobmFtZSkgPT4gbmFtZSArICdfJztcblxuY29uc3QgaW5kZW50TGluZXMgPSAobGluZXMsIGluZGVudGF0aW9uKSA9PiBsaW5lcy5zcGxpdCgnXFxuJykubWFwKChsaW5lLCBpKSA9PiBpID09PSAwID8gbGluZSA6IChfLnJlcGVhdCgnICcsIGluZGVudGF0aW9uKSArIGxpbmUpKS5qb2luKCdcXG4nKTtcblxuY29uc3QgT09MX01PRElGSUVSX1JFVFVSTiA9IHtcbiAgICBbT29sVHlwZXMuTW9kaWZpZXIuVkFMSURBVE9SXTogKCkgPT4gWyBKc0xhbmcuYXN0UmV0dXJuKHRydWUpIF0sXG4gICAgW09vbFR5cGVzLk1vZGlmaWVyLlBST0NFU1NPUl06IGFyZ3MgPT4gWyBKc0xhbmcuYXN0UmV0dXJuKEpzTGFuZy5hc3RJZChhcmdzWzBdKSkgXSxcbiAgICBbT29sVHlwZXMuTW9kaWZpZXIuQUNUSVZBVE9SXTogKCkgPT4gWyBKc0xhbmcuYXN0UmV0dXJuKEpzTGFuZy5hc3RJZChcInVuZGVmaW5lZFwiKSkgXVxufTtcblxuLyoqXG4gKiBPb2xvbmcgZGF0YWJhc2UgYWNjZXNzIG9iamVjdCAoREFPKSBtb2RlbGVyLlxuICogQGNsYXNzXG4gKi9cbmNsYXNzIERhb01vZGVsZXIge1xuICAgIC8qKiAgICAgXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGNvbnRleHRcbiAgICAgKiBAcHJvcGVydHkge0xvZ2dlcn0gY29udGV4dC5sb2dnZXIgLSBMb2dnZXIgb2JqZWN0ICAgICAgICAgIFxuICAgICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBjb250ZXh0Lm1vZGVsT3V0cHV0UGF0aCAtIEdlbmVyYXRlZCBtb2RlbCBvdXRwdXQgcGF0aFxuICAgICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBjb250ZXh0Lm1hbmlmZXN0T3V0cHV0UGF0aCAtIEVudGl0aWVzIG1hbmlmZXN0IG91dHB1dCBwYXRoXG4gICAgICogQHBhcmFtIHtDb25uZWN0b3J9IGNvbm5lY3RvciAgICAgIFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbnRleHQsIGNvbm5lY3Rvcikge1xuICAgICAgICB0aGlzLmxvZ2dlciA9IGNvbnRleHQubG9nZ2VyOyAgICAgICBcbiAgICAgICAgdGhpcy5vdXRwdXRQYXRoID0gY29udGV4dC5tb2RlbE91dHB1dFBhdGg7XG4gICAgICAgIHRoaXMubWFuaWZlc3RQYXRoID0gY29udGV4dC5tYW5pZmVzdE91dHB1dFBhdGg7XG5cbiAgICAgICAgdGhpcy5jb25uZWN0b3IgPSBjb25uZWN0b3I7ICAgICAgICBcbiAgICB9XG5cbiAgICBtb2RlbGluZ18oc2NoZW1hKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZygnaW5mbycsICdHZW5lcmF0aW5nIGVudGl0eSBtb2RlbHMgZm9yIHNjaGVtYSBcIicgKyBzY2hlbWEubmFtZSArICdcIi4uLicpO1xuXG4gICAgICAgIHRoaXMuX2dlbmVyYXRlU2NoZW1hTW9kZWwoc2NoZW1hKTtcbiAgICAgICAgdGhpcy5fZ2VuZXJhdGVFbnRpdHlNb2RlbChzY2hlbWEpO1xuICAgICAgICAvL3RoaXMuX2dlbmVyYXRlVmlld01vZGVsKCk7XG5cbiAgICAgICAgaWYgKHRoaXMubWFuaWZlc3RQYXRoKSB7XG4gICAgICAgICAgICB0aGlzLl9nZW5lcmF0ZUVudGl0eU1hbmlmZXN0KHNjaGVtYSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfZ2VuZXJhdGVTY2hlbWFNb2RlbChzY2hlbWEpIHtcbiAgICAgICAgbGV0IGNhcGl0YWxpemVkID0gcGFzY2FsQ2FzZShzY2hlbWEubmFtZSk7XG5cbiAgICAgICAgbGV0IGxvY2FscyA9IHtcbiAgICAgICAgICAgIGRyaXZlcjogdGhpcy5jb25uZWN0b3IuZHJpdmVyLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBjYXBpdGFsaXplZCxcbiAgICAgICAgICAgIHNjaGVtYU5hbWU6IHNjaGVtYS5uYW1lXG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IGNsYXNzVGVtcGxhdGUgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnZGF0YWJhc2UnLCB0aGlzLmNvbm5lY3Rvci5kcml2ZXIsICdEYXRhYmFzZS5qcy5zd2lnJyk7XG4gICAgICAgIGxldCBjbGFzc0NvZGUgPSBzd2lnLnJlbmRlckZpbGUoY2xhc3NUZW1wbGF0ZSwgbG9jYWxzKTtcblxuICAgICAgICBsZXQgbW9kZWxGaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLm91dHB1dFBhdGgsIGNhcGl0YWxpemVkICsgJy5qcycpO1xuICAgICAgICBmcy5lbnN1cmVGaWxlU3luYyhtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhtb2RlbEZpbGVQYXRoLCBjbGFzc0NvZGUpO1xuXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZygnaW5mbycsICdHZW5lcmF0ZWQgZGF0YWJhc2UgbW9kZWw6ICcgKyBtb2RlbEZpbGVQYXRoKTtcbiAgICB9XG5cbiAgICBfZ2VuZXJhdGVFbnRpdHlNb2RlbChzY2hlbWEpIHtcbiAgICAgICAgXy5mb3JPd24oc2NoZW1hLmVudGl0aWVzLCAoZW50aXR5LCBlbnRpdHlJbnN0YW5jZU5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCBjYXBpdGFsaXplZCA9IHBhc2NhbENhc2UoZW50aXR5SW5zdGFuY2VOYW1lKTsgICAgICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgLy9zaGFyZWQgaW5mb3JtYXRpb24gd2l0aCBtb2RlbCBDUlVEIGFuZCBjdXN0b21pemVkIGludGVyZmFjZXNcbiAgICAgICAgICAgIGxldCBzaGFyZWRDb250ZXh0ID0ge1xuICAgICAgICAgICAgICAgIG1hcE9mRnVuY3RvclRvRmlsZToge30sXG4gICAgICAgICAgICAgICAgbmV3RnVuY3RvckZpbGVzOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGV0IHsgYXN0OiBhc3RDbGFzc01haW4sIGZpZWxkUmVmZXJlbmNlcyB9ID0gdGhpcy5fcHJvY2Vzc0ZpZWxkTW9kaWZpZXJzKGVudGl0eSwgc2hhcmVkQ29udGV4dCk7XG4gICAgICAgICAgICBhc3RDbGFzc01haW4gPSBbIGFzdENsYXNzTWFpbiBdO1xuXG4gICAgICAgICAgICAvL3ByZXBhcmUgbWV0YSBkYXRhXG4gICAgICAgICAgICBsZXQgdW5pcXVlS2V5cyA9IFsgXy5jYXN0QXJyYXkoZW50aXR5LmtleSkgXTtcblxuICAgICAgICAgICAgaWYgKGVudGl0eS5pbmRleGVzKSB7XG4gICAgICAgICAgICAgICAgZW50aXR5LmluZGV4ZXMuZm9yRWFjaChpbmRleCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleC51bmlxdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUtleXMucHVzaChpbmRleC5maWVsZHMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBtb2RlbE1ldGEgPSB7XG4gICAgICAgICAgICAgICAgc2NoZW1hTmFtZTogc2NoZW1hLm5hbWUsXG4gICAgICAgICAgICAgICAgbmFtZTogZW50aXR5SW5zdGFuY2VOYW1lLFxuICAgICAgICAgICAgICAgIGtleUZpZWxkOiBlbnRpdHkua2V5LFxuICAgICAgICAgICAgICAgIGZpZWxkczogXy5tYXBWYWx1ZXMoZW50aXR5LmZpZWxkcywgZiA9PiBfLm9taXQoZi50b0pTT04oKSwgJ21vZGlmaWVycycpKSxcbiAgICAgICAgICAgICAgICBmZWF0dXJlczogZW50aXR5LmZlYXR1cmVzIHx8IHt9LFxuICAgICAgICAgICAgICAgIHVuaXF1ZUtleXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KGVudGl0eS5pbmRleGVzKSkge1xuICAgICAgICAgICAgICAgIG1vZGVsTWV0YS5pbmRleGVzID0gZW50aXR5LmluZGV4ZXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KGVudGl0eS5mZWF0dXJlcykpIHtcbiAgICAgICAgICAgICAgICBtb2RlbE1ldGEuZmVhdHVyZXMgPSBlbnRpdHkuZmVhdHVyZXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KGVudGl0eS5hc3NvY2lhdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgbW9kZWxNZXRhLmFzc29jaWF0aW9ucyA9IGVudGl0eS5hc3NvY2lhdGlvbnM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghXy5pc0VtcHR5KGZpZWxkUmVmZXJlbmNlcykpIHtcbiAgICAgICAgICAgICAgICBtb2RlbE1ldGEuZmllbGREZXBlbmRlbmNpZXMgPSBmaWVsZFJlZmVyZW5jZXM7XG4gICAgICAgICAgICB9ICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIC8vYnVpbGQgY3VzdG9taXplZCBpbnRlcmZhY2VzICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZW50aXR5LmludGVyZmFjZXMpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXN0SW50ZXJmYWNlcyA9IHRoaXMuX2J1aWxkSW50ZXJmYWNlcyhlbnRpdHksIG1vZGVsTWV0YSwgc2hhcmVkQ29udGV4dCk7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhhc3RJbnRlcmZhY2VzKTtcbiAgICAgICAgICAgICAgICAvL2xldCBhc3RDbGFzcyA9IGFzdENsYXNzTWFpblthc3RDbGFzc01haW4ubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgLy9Kc0xhbmcuYXN0UHVzaEluQm9keShhc3RDbGFzcywgYXN0SW50ZXJmYWNlcyk7XG4gICAgICAgICAgICAgICAgYXN0Q2xhc3NNYWluID0gYXN0Q2xhc3NNYWluLmNvbmNhdChhc3RJbnRlcmZhY2VzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGltcG9ydExpbmVzID0gW107XG5cbiAgICAgICAgICAgIC8vZ2VuZXJhdGUgZnVuY3RvcnMgaWYgYW55XG4gICAgICAgICAgICBpZiAoIV8uaXNFbXB0eShzaGFyZWRDb250ZXh0Lm1hcE9mRnVuY3RvclRvRmlsZSkpIHtcbiAgICAgICAgICAgICAgICBfLmZvck93bihzaGFyZWRDb250ZXh0Lm1hcE9mRnVuY3RvclRvRmlsZSwgKGZpbGVOYW1lLCBmdW5jdGlvbk5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0TGluZXMucHVzaChKc0xhbmcuYXN0VG9Db2RlKEpzTGFuZy5hc3RSZXF1aXJlKGZ1bmN0aW9uTmFtZSwgZmlsZU5hbWUpKSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFfLmlzRW1wdHkoc2hhcmVkQ29udGV4dC5uZXdGdW5jdG9yRmlsZXMpKSB7XG4gICAgICAgICAgICAgICAgXy5lYWNoKHNoYXJlZENvbnRleHQubmV3RnVuY3RvckZpbGVzLCBlbnRyeSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dlbmVyYXRlRnVuY3Rpb25UZW1wbGF0ZUZpbGUoc2NoZW1hLCBlbnRyeSk7ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IG1peGlucyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoIV8uaXNFbXB0eShlbnRpdHkuaW5mby5taXhpbnMpKSB7XG4gICAgICAgICAgICAgICAgbGV0IG1peGluc0RpclBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5vdXRwdXRQYXRoLCBzY2hlbWEubmFtZSwgJ21peGlucycpO1xuICAgICAgICAgICAgICAgIGZzLmVuc3VyZURpclN5bmMobWl4aW5zRGlyUGF0aCk7XG5cbiAgICAgICAgICAgICAgICBlbnRpdHkuaW5mby5taXhpbnMuZm9yRWFjaChtID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1peGluTmFtZSA9IHBhc2NhbENhc2UobSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IG1peGluRmlsZVBhdGggPSBwYXRoLmpvaW4obWl4aW5zRGlyUGF0aCwgbWl4aW5OYW1lICsgJy5qcycpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZzLnBhdGhFeGlzdHNTeW5jKG1peGluRmlsZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG1peGluRmlsZVBhdGgsIFwidGhyb3cgbmV3IEVycm9yKCd0byBiZSBpbXBsZW1lbnRlZC4uLicpXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IG1peGluVmFyTmFtZSA9ICdtaXhpbicgKyBtaXhpbk5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGltcG9ydExpbmVzLnB1c2goSnNMYW5nLmFzdFRvQ29kZShKc0xhbmcuYXN0UmVxdWlyZShtaXhpblZhck5hbWUsICcuL21peGlucy8nICsgbWl4aW5OYW1lKSkpO1xuICAgICAgICAgICAgICAgICAgICBtaXhpbnMucHVzaChtaXhpblZhck5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL2Fzc2VtYmxlIHRoZSBzb3VyY2UgY29kZSBmaWxlXG4gICAgICAgICAgICAvL0pzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgYXN0Q2xhc3NNYWluKTtcblxuICAgICAgICAgICAgLy9Kc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIGVudGl0eS5maWVsZHMubWFwKCh2LCBrKSA9PiBKc0xhbmcuYXN0QXNzaWduKGNhcGl0YWxpemVkICsgJy5GXycgKyBfLnNuYWtlQ2FzZShrKS50b1VwcGVyQ2FzZSgpLCBrKSkpOyAgIFxuXG4gICAgICAgICAgICBsZXQgbG9jYWxzID0ge1xuICAgICAgICAgICAgICAgIGltcG9ydHM6IGltcG9ydExpbmVzLmpvaW4oJ1xcbicpLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogY2FwaXRhbGl6ZWQsXG4gICAgICAgICAgICAgICAgZW50aXR5TWV0YTogaW5kZW50TGluZXMoSlNPTi5zdHJpbmdpZnkobW9kZWxNZXRhLCBudWxsLCA0KSwgNCksXG4gICAgICAgICAgICAgICAgY2xhc3NCb2R5OiBpbmRlbnRMaW5lcyhhc3RDbGFzc01haW4ubWFwKGJsb2NrID0+IEpzTGFuZy5hc3RUb0NvZGUoYmxvY2spKS5qb2luKCdcXG5cXG4nKSwgOCksXG4gICAgICAgICAgICAgICAgZnVuY3RvcnM6IGluZGVudExpbmVzKEpzTGFuZy5hc3RUb0NvZGUoSnNMYW5nLmFzdFZhbHVlKF8ucmVkdWNlKHNoYXJlZENvbnRleHQubmV3RnVuY3RvckZpbGVzLCAocmVzdWx0LCBmdW5jdG9yKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnJCcgKyBmdW5jdG9yLmZ1bmN0aW9uTmFtZV0gPSBKc0xhbmcuYXN0SWQoZnVuY3Rvci5mdW5jdGlvbk5hbWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgIH0sIHt9KSkpLCA0KSxcbiAgICAgICAgICAgICAgICBtaXhpbnMgXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgY2xhc3NUZW1wbGF0ZSA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdkYXRhYmFzZScsIHRoaXMuY29ubmVjdG9yLmRyaXZlciwgJ0VudGl0eU1vZGVsLmpzLnN3aWcnKTtcbiAgICAgICAgICAgIGxldCBjbGFzc0NvZGUgPSBzd2lnLnJlbmRlckZpbGUoY2xhc3NUZW1wbGF0ZSwgbG9jYWxzKTtcblxuICAgICAgICAgICAgbGV0IG1vZGVsRmlsZVBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5vdXRwdXRQYXRoLCBzY2hlbWEubmFtZSwgY2FwaXRhbGl6ZWQgKyAnLmpzJyk7XG4gICAgICAgICAgICBmcy5lbnN1cmVGaWxlU3luYyhtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMobW9kZWxGaWxlUGF0aCwgY2xhc3NDb2RlKTtcblxuICAgICAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRlZCBlbnRpdHkgbW9kZWw6ICcgKyBtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgX2dlbmVyYXRlRW50aXR5TWFuaWZlc3Qoc2NoZW1hKSB7XG4gICAgICAgIGxldCBlbnRpdGllcyA9IE9iamVjdC5rZXlzKHNjaGVtYS5lbnRpdGllcykuc29ydCgpLnJlZHVjZSgocmVzdWx0LCB2KSA9PiB7IHJlc3VsdFt2XSA9IHt9OyByZXR1cm4gcmVzdWx0OyB9LCB7fSk7XG5cbiAgICAgICAgbGV0IG91dHB1dEZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMubWFuaWZlc3RQYXRoLCBzY2hlbWEubmFtZSArICcubWFuaWZlc3QuanNvbicpO1xuICAgICAgICBmcy5lbnN1cmVGaWxlU3luYyhvdXRwdXRGaWxlUGF0aCk7XG4gICAgICAgIGZzLndyaXRlRmlsZVN5bmMob3V0cHV0RmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KGVudGl0aWVzLCBudWxsLCA0KSk7XG5cbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdpbmZvJywgJ0dlbmVyYXRlZCBzY2hlbWEgbWFuaWZlc3Q6ICcgKyBvdXRwdXRGaWxlUGF0aCk7XG4gICAgfVxuXG4gICAgLypcbiAgICBfZ2VuZXJhdGVWaWV3TW9kZWwoc2NoZW1hLCBkYlNlcnZpY2UpIHsgICAgICAgIFxuICAgICAgICBfLmZvck93bihzY2hlbWEudmlld3MsICh2aWV3SW5mbywgdmlld05hbWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0J1aWxkaW5nIHZpZXc6ICcgKyB2aWV3TmFtZSk7XG5cbiAgICAgICAgICAgIGxldCBjYXBpdGFsaXplZCA9IF8udXBwZXJGaXJzdCh2aWV3TmFtZSk7XG5cbiAgICAgICAgICAgIGxldCBhc3QgPSBKc0xhbmcuYXN0UHJvZ3JhbSgpO1xuXG4gICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RSZXF1aXJlKCdNb3dhJywgJ21vd2EnKSk7XG4gICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RWYXJEZWNsYXJlKCdVdGlsJywgSnNMYW5nLmFzdFZhclJlZignTW93YS5VdGlsJyksIHRydWUpKTtcbiAgICAgICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdFZhckRlY2xhcmUoJ18nLCBKc0xhbmcuYXN0VmFyUmVmKCdVdGlsLl8nKSwgdHJ1ZSkpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0UmVxdWlyZSgnVmlldycsICdtb3dhL2xpYi9vb2xvbmcvcnVudGltZS92aWV3JykpO1xuXG4gICAgICAgICAgICBsZXQgY29tcGlsZUNvbnRleHQgPSBPb2xUb0FzdC5jcmVhdGVDb21waWxlQ29udGV4dCh2aWV3TmFtZSwgZGJTZXJ2aWNlLnNlcnZpY2VJZCwgdGhpcy5sb2dnZXIpO1xuXG4gICAgICAgICAgICBjb21waWxlQ29udGV4dC5tb2RlbFZhcnMuYWRkKHZpZXdJbmZvLmVudGl0eSk7XG5cbiAgICAgICAgICAgIGxldCBwYXJhbU1ldGE7XG5cbiAgICAgICAgICAgIGlmICh2aWV3SW5mby5wYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbU1ldGEgPSB0aGlzLl9wcm9jZXNzUGFyYW1zKHZpZXdJbmZvLnBhcmFtcywgY29tcGlsZUNvbnRleHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgdmlld01ldGEgPSB7XG4gICAgICAgICAgICAgICAgaXNMaXN0OiB2aWV3SW5mby5pc0xpc3QsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbU1ldGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxldCB2aWV3Qm9keVRvcG9JZCA9IE9vbFRvQXN0LmNyZWF0ZVRvcG9JZChjb21waWxlQ29udGV4dCwgJyR2aWV3Jyk7XG4gICAgICAgICAgICBPb2xUb0FzdC5kZXBlbmRzT24oY29tcGlsZUNvbnRleHQsIGNvbXBpbGVDb250ZXh0Lm1haW5TdGFydElkLCB2aWV3Qm9keVRvcG9JZCk7XG5cbiAgICAgICAgICAgIGxldCB2aWV3TW9kZWxlciA9IHJlcXVpcmUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4vZGFvL3ZpZXcnLCBkYlNlcnZpY2UuZGJUeXBlICsgJy5qcycpKTtcbiAgICAgICAgICAgIGNvbXBpbGVDb250ZXh0LmFzdE1hcFt2aWV3Qm9keVRvcG9JZF0gPSB2aWV3TW9kZWxlcihkYlNlcnZpY2UsIHZpZXdOYW1lLCB2aWV3SW5mbyk7XG4gICAgICAgICAgICBPb2xUb0FzdC5hZGRDb2RlQmxvY2soY29tcGlsZUNvbnRleHQsIHZpZXdCb2R5VG9wb0lkLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogT29sVG9Bc3QuQVNUX0JMS19WSUVXX09QRVJBVElPTlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCByZXR1cm5Ub3BvSWQgPSBPb2xUb0FzdC5jcmVhdGVUb3BvSWQoY29tcGlsZUNvbnRleHQsICckcmV0dXJuOnZhbHVlJyk7XG4gICAgICAgICAgICBPb2xUb0FzdC5kZXBlbmRzT24oY29tcGlsZUNvbnRleHQsIHZpZXdCb2R5VG9wb0lkLCByZXR1cm5Ub3BvSWQpO1xuICAgICAgICAgICAgT29sVG9Bc3QuY29tcGlsZVJldHVybihyZXR1cm5Ub3BvSWQsIHtcbiAgICAgICAgICAgICAgICBcIm9vbFR5cGVcIjogXCJPYmplY3RSZWZlcmVuY2VcIixcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJ2aWV3RGF0YVwiXG4gICAgICAgICAgICB9LCBjb21waWxlQ29udGV4dCk7XG5cbiAgICAgICAgICAgIGxldCBkZXBzID0gY29tcGlsZUNvbnRleHQudG9wb1NvcnQuc29ydCgpO1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIudmVyYm9zZSgnQWxsIGRlcGVuZGVuY2llczpcXG4nICsgSlNPTi5zdHJpbmdpZnkoZGVwcywgbnVsbCwgMikpO1xuXG4gICAgICAgICAgICBkZXBzID0gZGVwcy5maWx0ZXIoZGVwID0+IGNvbXBpbGVDb250ZXh0Lm1hcE9mVG9rZW5Ub01ldGEuaGFzKGRlcCkpO1xuICAgICAgICAgICAgdGhpcy5sb2dnZXIudmVyYm9zZSgnQWxsIG5lY2Vzc2FyeSBzb3VyY2UgY29kZTpcXG4nICsgSlNPTi5zdHJpbmdpZnkoZGVwcywgbnVsbCwgMikpO1xuXG4gICAgICAgICAgICBsZXQgYXN0RG9Mb2FkTWFpbiA9IFtcbiAgICAgICAgICAgICAgICBKc0xhbmcuYXN0VmFyRGVjbGFyZSgnJG1ldGEnLCBKc0xhbmcuYXN0VmFyUmVmKCd0aGlzLm1ldGEnKSwgdHJ1ZSwgZmFsc2UsICdSZXRyaWV2aW5nIHRoZSBtZXRhIGRhdGEnKVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgXy5lYWNoKGRlcHMsIGRlcCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGFzdE1ldGEgPSBjb21waWxlQ29udGV4dC5tYXBPZlRva2VuVG9NZXRhLmdldChkZXApO1xuXG4gICAgICAgICAgICAgICAgbGV0IGFzdEJsb2NrID0gY29tcGlsZUNvbnRleHQuYXN0TWFwW2RlcF07XG4gICAgICAgICAgICAgICAgYXNzZXJ0OiBhc3RCbG9jaywgJ0VtcHR5IGFzdCBibG9jayc7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXN0TWV0YS50eXBlID09PSAnTW9kaWZpZXJDYWxsJykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZmllbGROYW1lID0gZ2V0RmllbGROYW1lKGFzdE1ldGEudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFzdENhY2hlID0gSnNMYW5nLmFzdEFzc2lnbihKc0xhbmcuYXN0VmFyUmVmKGFzdE1ldGEudGFyZ2V0KSwgYXN0QmxvY2ssIGBNb2RpZnlpbmcgJHtmaWVsZE5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgIGFzdERvTG9hZE1haW4ucHVzaChhc3RDYWNoZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhc3REb0xvYWRNYWluID0gYXN0RG9Mb2FkTWFpbi5jb25jYXQoXy5jYXN0QXJyYXkoY29tcGlsZUNvbnRleHQuYXN0TWFwW2RlcF0pKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIV8uaXNFbXB0eShjb21waWxlQ29udGV4dC5tYXBPZkZ1bmN0b3JUb0ZpbGUpKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JPd24oY29tcGlsZUNvbnRleHQubWFwT2ZGdW5jdG9yVG9GaWxlLCAoZmlsZU5hbWUsIGZ1bmN0aW9uTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBKc0xhbmcuYXN0UHVzaEluQm9keShhc3QsIEpzTGFuZy5hc3RSZXF1aXJlKGZ1bmN0aW9uTmFtZSwgJy4nICsgZmlsZU5hbWUpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFfLmlzRW1wdHkoY29tcGlsZUNvbnRleHQubmV3RnVuY3RvckZpbGVzKSkge1xuICAgICAgICAgICAgICAgIF8uZWFjaChjb21waWxlQ29udGV4dC5uZXdGdW5jdG9yRmlsZXMsIGVudHJ5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGVGdW5jdGlvblRlbXBsYXRlRmlsZShkYlNlcnZpY2UsIGVudHJ5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0Q2xhc3NEZWNsYXJlKGNhcGl0YWxpemVkLCAnVmlldycsIFtcbiAgICAgICAgICAgICAgICBKc0xhbmcuYXN0TWVtYmVyTWV0aG9kKCdfZG9Mb2FkJywgT2JqZWN0LmtleXMocGFyYW1NZXRhKSxcbiAgICAgICAgICAgICAgICAgICAgYXN0RG9Mb2FkTWFpbixcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIHRydWUsIGZhbHNlLCAnUG9wdWxhdGUgdmlldyBkYXRhJ1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0sIGAke2NhcGl0YWxpemVkfSB2aWV3YCkpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0QXNzaWduKGNhcGl0YWxpemVkICsgJy5tZXRhJywgSnNMYW5nLmFzdFZhbHVlKHZpZXdNZXRhKSkpO1xuICAgICAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0QXNzaWduKCdtb2R1bGUuZXhwb3J0cycsIEpzTGFuZy5hc3RWYXJSZWYoY2FwaXRhbGl6ZWQpKSk7XG5cbiAgICAgICAgICAgIGxldCBtb2RlbEZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMub3V0cHV0UGF0aCwgZGJTZXJ2aWNlLmRiVHlwZSwgZGJTZXJ2aWNlLm5hbWUsICd2aWV3cycsIHZpZXdOYW1lICsgJy5qcycpO1xuICAgICAgICAgICAgZnMuZW5zdXJlRmlsZVN5bmMobW9kZWxGaWxlUGF0aCk7XG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKG1vZGVsRmlsZVBhdGggKyAnLmpzb24nLCBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgRGFvTW9kZWxlci5fZXhwb3J0U291cmNlQ29kZShhc3QsIG1vZGVsRmlsZVBhdGgpO1xuXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2luZm8nLCAnR2VuZXJhdGVkIHZpZXcgbW9kZWw6ICcgKyBtb2RlbEZpbGVQYXRoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAqL1xuXG4gICAgX3Byb2Nlc3NGaWVsZE1vZGlmaWVycyhlbnRpdHksIHNoYXJlZENvbnRleHQpIHtcbiAgICAgICAgbGV0IGNvbXBpbGVDb250ZXh0ID0gT29sVG9Bc3QuY3JlYXRlQ29tcGlsZUNvbnRleHQoZW50aXR5Lm9vbE1vZHVsZS5uYW1lLCB0aGlzLmxvZ2dlciwgc2hhcmVkQ29udGV4dCk7XG4gICAgICAgIGNvbXBpbGVDb250ZXh0LnZhcmlhYmxlc1sncmF3J10gPSB7IHNvdXJjZTogJ2NvbnRleHQnLCBmaW5hbGl6ZWQ6IHRydWUgfTtcbiAgICAgICAgY29tcGlsZUNvbnRleHQudmFyaWFibGVzWydpMThuJ10gPSB7IHNvdXJjZTogJ2NvbnRleHQnLCBmaW5hbGl6ZWQ6IHRydWUgfTtcbiAgICAgICAgY29tcGlsZUNvbnRleHQudmFyaWFibGVzWydjb25uZWN0b3InXSA9IHsgc291cmNlOiAnY29udGV4dCcsIGZpbmFsaXplZDogdHJ1ZSB9O1xuICAgICAgICBjb21waWxlQ29udGV4dC52YXJpYWJsZXNbJ2xhdGVzdCddID0geyBzb3VyY2U6ICdjb250ZXh0JyB9O1xuXG4gICAgICAgIGNvbnN0IGFsbEZpbmlzaGVkID0gT29sVG9Bc3QuY3JlYXRlVG9wb0lkKGNvbXBpbGVDb250ZXh0LCAnZG9uZS4nKTtcblxuICAgICAgICAvL21hcCBvZiBmaWVsZCBuYW1lIHRvIGRlcGVuZGVuY2llc1xuICAgICAgICBsZXQgZmllbGRSZWZlcmVuY2VzID0ge307XG5cbiAgICAgICAgXy5mb3JPd24oZW50aXR5LmZpZWxkcywgKGZpZWxkLCBmaWVsZE5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCB0b3BvSWQgPSBPb2xUb0FzdC5jb21waWxlRmllbGQoZmllbGROYW1lLCBmaWVsZCwgY29tcGlsZUNvbnRleHQpO1xuICAgICAgICAgICAgT29sVG9Bc3QuZGVwZW5kc09uKGNvbXBpbGVDb250ZXh0LCB0b3BvSWQsIGFsbEZpbmlzaGVkKTtcblxuICAgICAgICAgICAgaWYgKGZpZWxkLndyaXRlT25jZSB8fCBmaWVsZC5mcmVlemVBZnRlck5vbkRlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBwdXRJbnRvQnVja2V0KGZpZWxkUmVmZXJlbmNlcywgZmllbGROYW1lLCBmaWVsZE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZGVwcyA9IGNvbXBpbGVDb250ZXh0LnRvcG9Tb3J0LnNvcnQoKTtcbiAgICAgICAgLy90aGlzLmxvZ2dlci52ZXJib3NlKCdBbGwgZGVwZW5kZW5jaWVzOlxcbicgKyBKU09OLnN0cmluZ2lmeShkZXBzLCBudWxsLCAyKSk7XG5cbiAgICAgICAgZGVwcyA9IGRlcHMuZmlsdGVyKGRlcCA9PiBjb21waWxlQ29udGV4dC5tYXBPZlRva2VuVG9NZXRhLmhhcyhkZXApKTtcbiAgICAgICAgLy90aGlzLmxvZ2dlci52ZXJib3NlKCdBbGwgbmVjZXNzYXJ5IHNvdXJjZSBjb2RlOlxcbicgKyBKU09OLnN0cmluZ2lmeShkZXBzLCBudWxsLCAyKSk7XG5cbiAgICAgICAgbGV0IG1ldGhvZEJvZHlWYWxpZGF0ZUFuZEZpbGwgPSBbXSwgbGFzdEZpZWxkc0dyb3VwLCBcbiAgICAgICAgICAgIG1ldGhvZEJvZHlDYWNoZSA9IFtdLCBcbiAgICAgICAgICAgIGxhc3RCbG9jaywgbGFzdEFzdFR5cGU7Ly8sIGhhc1ZhbGlkYXRvciA9IGZhbHNlO1xuXG4gICAgICAgIGNvbnN0IF9tZXJnZURvVmFsaWRhdGVBbmRGaWxsQ29kZSA9IGZ1bmN0aW9uIChmaWVsZE5hbWUsIHJlZmVyZW5jZXMsIGFzdENhY2hlLCByZXF1aXJlVGFyZ2V0RmllbGQpIHsgXG4gICAgICAgICAgICBsZXQgZmllbGRzID0gKHJlcXVpcmVUYXJnZXRGaWVsZCA/IFsgZmllbGROYW1lIF0gOiBbXSkuY29uY2F0KHJlZmVyZW5jZXMpO1xuICAgICAgICAgICAgbGV0IGNoZWNrZXIgPSBmaWVsZHMuam9pbignLCcpO1xuXG4gICAgICAgICAgICBpZiAobGFzdEZpZWxkc0dyb3VwICYmIGxhc3RGaWVsZHNHcm91cC5jaGVja2VyICE9PSBjaGVja2VyKSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kQm9keVZhbGlkYXRlQW5kRmlsbCA9IG1ldGhvZEJvZHlWYWxpZGF0ZUFuZEZpbGwuY29uY2F0KFxuICAgICAgICAgICAgICAgICAgICBTbmlwcGV0cy5fZmllbGRSZXF1aXJlbWVudENoZWNrKGxhc3RGaWVsZHNHcm91cC5maWVsZE5hbWUsIGxhc3RGaWVsZHNHcm91cC5yZWZlcmVuY2VzLCBtZXRob2RCb2R5Q2FjaGUsIGxhc3RGaWVsZHNHcm91cC5yZXF1aXJlVGFyZ2V0RmllbGQpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBtZXRob2RCb2R5Q2FjaGUgPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWV0aG9kQm9keUNhY2hlID0gbWV0aG9kQm9keUNhY2hlLmNvbmNhdChhc3RDYWNoZSk7XG4gICAgICAgICAgICBsYXN0RmllbGRzR3JvdXAgPSB7XG4gICAgICAgICAgICAgICAgZmllbGROYW1lLFxuICAgICAgICAgICAgICAgIHJlZmVyZW5jZXMsXG4gICAgICAgICAgICAgICAgcmVxdWlyZVRhcmdldEZpZWxkLCAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjaGVja2VyLFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vY29uc29sZS5kaXIoY29tcGlsZUNvbnRleHQuYXN0TWFwWydtb2JpbGV+aXNNb2JpbGVQaG9uZTphcmdbMV18PnN0cmluZ0Rhc2hlcml6ZSddLCB7IGRlcHRoOiA4IH0pOyBcblxuICAgICAgICBfLmVhY2goZGVwcywgKGRlcCwgaSkgPT4ge1xuICAgICAgICAgICAgLy9nZXQgbWV0YWRhdGEgb2Ygc291cmNlIGNvZGUgYmxvY2tcbiAgICAgICAgICAgIGxldCBzb3VyY2VNYXAgPSBjb21waWxlQ29udGV4dC5tYXBPZlRva2VuVG9NZXRhLmdldChkZXApO1xuXG4gICAgICAgICAgICAvL2dldCBzb3VyY2UgY29kZSBibG9ja1xuICAgICAgICAgICAgbGV0IGFzdEJsb2NrID0gY29tcGlsZUNvbnRleHQuYXN0TWFwW2RlcF07XG5cbiAgICAgICAgICAgIGxldCB0YXJnZXRGaWVsZE5hbWUgPSBnZXRGaWVsZE5hbWUoc291cmNlTWFwLnRhcmdldCk7ICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIGlmIChzb3VyY2VNYXAucmVmZXJlbmNlcykge1xuICAgICAgICAgICAgICAgIGxldCBmaWVsZFJlZmVyZW5jZSA9IGZpZWxkUmVmZXJlbmNlc1t0YXJnZXRGaWVsZE5hbWVdO1xuICAgICAgICAgICAgICAgIGlmICghZmllbGRSZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRSZWZlcmVuY2VzW3RhcmdldEZpZWxkTmFtZV0gPSBmaWVsZFJlZmVyZW5jZSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNvdXJjZU1hcC5yZWZlcmVuY2VzLmZvckVhY2gocmVmID0+IHsgaWYgKGZpZWxkUmVmZXJlbmNlLmluZGV4T2YocmVmKSA9PT0gLTEpIGZpZWxkUmVmZXJlbmNlLnB1c2gocmVmKTsgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChsYXN0QmxvY2spIHtcbiAgICAgICAgICAgICAgICBhc3RCbG9jayA9IGNoYWluQ2FsbChsYXN0QmxvY2ssIGxhc3RBc3RUeXBlLCBhc3RCbG9jaywgc291cmNlTWFwLnR5cGUpO1xuICAgICAgICAgICAgICAgIGxhc3RCbG9jayA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGkgPCBkZXBzLmxlbmd0aC0xKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5leHRUeXBlID0gY29tcGlsZUNvbnRleHQubWFwT2ZUb2tlblRvTWV0YS5nZXQoZGVwc1tpKzFdKTtcblxuICAgICAgICAgICAgICAgIGlmIChpc0NoYWluYWJsZShzb3VyY2VNYXAsIG5leHRUeXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0QmxvY2sgPSBhc3RCbG9jaztcbiAgICAgICAgICAgICAgICAgICAgbGFzdEFzdFR5cGUgPSBzb3VyY2VNYXAudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gICAgICAgICAgICBcblxuICAgICAgICAgICAgaWYgKHNvdXJjZU1hcC50eXBlID09PSBPb2xUb0FzdC5BU1RfQkxLX1ZBTElEQVRPUl9DQUxMKSB7XG4gICAgICAgICAgICAgICAgLy9oYXNWYWxpZGF0b3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGxldCBhc3RDYWNoZSA9IFNuaXBwZXRzLl92YWxpZGF0ZUNoZWNrKHRhcmdldEZpZWxkTmFtZSwgYXN0QmxvY2spO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIF9tZXJnZURvVmFsaWRhdGVBbmRGaWxsQ29kZSh0YXJnZXRGaWVsZE5hbWUsIHNvdXJjZU1hcC5yZWZlcmVuY2VzLCBhc3RDYWNoZSwgdHJ1ZSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc291cmNlTWFwLnR5cGUgPT09IE9vbFRvQXN0LkFTVF9CTEtfUFJPQ0VTU09SX0NBTEwpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXN0Q2FjaGUgPSBKc0xhbmcuYXN0QXNzaWduKEpzTGFuZy5hc3RWYXJSZWYoc291cmNlTWFwLnRhcmdldCwgdHJ1ZSksIGFzdEJsb2NrLCBgUHJvY2Vzc2luZyBcIiR7dGFyZ2V0RmllbGROYW1lfVwiYCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgX21lcmdlRG9WYWxpZGF0ZUFuZEZpbGxDb2RlKHRhcmdldEZpZWxkTmFtZSwgc291cmNlTWFwLnJlZmVyZW5jZXMsIGFzdENhY2hlLCB0cnVlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc291cmNlTWFwLnR5cGUgPT09IE9vbFRvQXN0LkFTVF9CTEtfQUNUSVZBVE9SX0NBTEwpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXN0Q2FjaGUgPSBKc0xhbmcuYXN0QXNzaWduKEpzTGFuZy5hc3RWYXJSZWYoc291cmNlTWFwLnRhcmdldCwgdHJ1ZSksIGFzdEJsb2NrLCBgQWN0aXZhdGluZyBcIiR7dGFyZ2V0RmllbGROYW1lfVwiYCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgX21lcmdlRG9WYWxpZGF0ZUFuZEZpbGxDb2RlKHRhcmdldEZpZWxkTmFtZSwgc291cmNlTWFwLnJlZmVyZW5jZXMsIGFzdENhY2hlLCBmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVG8gYmUgaW1wbGVtZW50ZWQuJyk7XG4gICAgICAgICAgICAgICAgLy9hc3RCbG9jayA9IF8uY2FzdEFycmF5KGFzdEJsb2NrKTsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy9fbWVyZ2VEb1ZhbGlkYXRlQW5kRmlsbENvZGUodGFyZ2V0RmllbGROYW1lLCBbXSwgYXN0QmxvY2spOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qIENoYW5nZWQgdG8gdGhyb3cgZXJyb3IgaW5zdGVhZCBvZiByZXR1cm5pbmcgYSBlcnJvciBvYmplY3RcbiAgICAgICAgaWYgKGhhc1ZhbGlkYXRvcikge1xuICAgICAgICAgICAgbGV0IGRlY2xhcmUgPSBKc0xhbmcuYXN0VmFyRGVjbGFyZSh2YWxpZFN0YXRlTmFtZSwgZmFsc2UpO1xuICAgICAgICAgICAgbWV0aG9kQm9keUNyZWF0ZS51bnNoaWZ0KGRlY2xhcmUpO1xuICAgICAgICAgICAgbWV0aG9kQm9keVVwZGF0ZS51bnNoaWZ0KGRlY2xhcmUpO1xuICAgICAgICB9XG4gICAgICAgICovXG5cbiAgICAgICAgaWYgKCFfLmlzRW1wdHkobWV0aG9kQm9keUNhY2hlKSkge1xuICAgICAgICAgICAgbWV0aG9kQm9keVZhbGlkYXRlQW5kRmlsbCA9IG1ldGhvZEJvZHlWYWxpZGF0ZUFuZEZpbGwuY29uY2F0KFxuICAgICAgICAgICAgICAgIFNuaXBwZXRzLl9maWVsZFJlcXVpcmVtZW50Q2hlY2sobGFzdEZpZWxkc0dyb3VwLmZpZWxkTmFtZSwgXG4gICAgICAgICAgICAgICAgICAgIGxhc3RGaWVsZHNHcm91cC5yZWZlcmVuY2VzLCBcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kQm9keUNhY2hlLCBcbiAgICAgICAgICAgICAgICAgICAgbGFzdEZpZWxkc0dyb3VwLnJlcXVpcmVUYXJnZXRGaWVsZFxuICAgICAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgfSAgICAgIFxuICAgICAgICBcbiAgICAgICAgLypcbiAgICAgICAgbGV0IGFzdCA9IEpzTGFuZy5hc3RQcm9ncmFtKGZhbHNlKTtcbiAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0Q2xhc3NEZWNsYXJlKCdBYmMnLCAnTW9kZWwnLCBbXG4gICAgICAgICAgICBKc0xhbmcuYXN0TWVtYmVyTWV0aG9kKGFzeW5jTWV0aG9kTmFtaW5nKCdwcmVwYXJlRW50aXR5RGF0YV8nKSwgWyAnY29udGV4dCcgXSxcbiAgICAgICAgICAgIFNuaXBwZXRzLl9kb1ZhbGlkYXRlQW5kRmlsbEhlYWRlci5jb25jYXQobWV0aG9kQm9keVZhbGlkYXRlQW5kRmlsbCkuY29uY2F0KFsgSnNMYW5nLmFzdFJldHVybihKc0xhbmcuYXN0SWQoJ2NvbnRleHQnKSkgXSksXG4gICAgICAgICAgICBmYWxzZSwgdHJ1ZSwgdHJ1ZVxuICAgICAgICApXSwgJ2NvbW1lbnQnKSk7XG4gICAgICAgICovXG5cbiAgICAgICAgcmV0dXJuIHsgYXN0OiBKc0xhbmcuYXN0TWVtYmVyTWV0aG9kKGFzeW5jTWV0aG9kTmFtaW5nKCdhcHBseU1vZGlmaWVycycpLCBbICdjb250ZXh0JywgJ2lzVXBkYXRpbmcnIF0sXG4gICAgICAgICAgICBTbmlwcGV0cy5fYXBwbHlNb2RpZmllcnNIZWFkZXIuY29uY2F0KG1ldGhvZEJvZHlWYWxpZGF0ZUFuZEZpbGwpLmNvbmNhdChbIEpzTGFuZy5hc3RSZXR1cm4oSnNMYW5nLmFzdElkKCdjb250ZXh0JykpIF0pLFxuICAgICAgICAgICAgZmFsc2UsIHRydWUsIHRydWUsICdBcHBseWluZyBwcmVkZWZpbmVkIG1vZGlmaWVycyB0byBlbnRpdHkgZmllbGRzLidcbiAgICAgICAgKSwgZmllbGRSZWZlcmVuY2VzIH07XG4gICAgfVxuXG4gICAgX2dlbmVyYXRlRnVuY3Rpb25UZW1wbGF0ZUZpbGUoc2NoZW1hLCB7IGZ1bmN0aW9uTmFtZSwgZnVuY3RvclR5cGUsIGZpbGVOYW1lLCBhcmdzIH0pIHtcbiAgICAgICAgbGV0IGZpbGVQYXRoID0gcGF0aC5yZXNvbHZlKFxuICAgICAgICAgICAgdGhpcy5vdXRwdXRQYXRoLFxuICAgICAgICAgICAgc2NoZW1hLm5hbWUsXG4gICAgICAgICAgICBmaWxlTmFtZVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xuICAgICAgICAgICAgLy90b2RvOiBhbmFseXNlIGNvZGUsIGNvbXBhcmUgYXJndW1lbnRzXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ2luZm8nLCBgJHsgXy51cHBlckZpcnN0KGZ1bmN0b3JUeXBlKSB9IFwiJHtmaWxlTmFtZX1cIiBleGlzdHMuIEZpbGUgZ2VuZXJhdGluZyBza2lwcGVkLmApO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYXN0ID0gSnNMYW5nLmFzdFByb2dyYW0oKTtcbiAgICAgICAgXG4gICAgICAgIEpzTGFuZy5hc3RQdXNoSW5Cb2R5KGFzdCwgSnNMYW5nLmFzdEZ1bmN0aW9uKGZ1bmN0aW9uTmFtZSwgYXJncywgT09MX01PRElGSUVSX1JFVFVSTltmdW5jdG9yVHlwZV0oYXJncykpKTtcbiAgICAgICAgSnNMYW5nLmFzdFB1c2hJbkJvZHkoYXN0LCBKc0xhbmcuYXN0QXNzaWduKCdtb2R1bGUuZXhwb3J0cycsIEpzTGFuZy5hc3RWYXJSZWYoZnVuY3Rpb25OYW1lKSkpO1xuXG4gICAgICAgIGZzLmVuc3VyZUZpbGVTeW5jKGZpbGVQYXRoKTtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSnNMYW5nLmFzdFRvQ29kZShhc3QpKTtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKCdpbmZvJywgYEdlbmVyYXRlZCAkeyBmdW5jdG9yVHlwZSB9IGZpbGU6ICR7ZmlsZVBhdGh9YCk7XG4gICAgfVxuXG4gICAgX2J1aWxkSW50ZXJmYWNlcyhlbnRpdHksIG1vZGVsTWV0YUluaXQsIHNoYXJlZENvbnRleHQpIHtcbiAgICAgICAgbGV0IGFzdCA9IFtdO1xuXG4gICAgICAgIF8uZm9yT3duKGVudGl0eS5pbnRlcmZhY2VzLCAobWV0aG9kLCBuYW1lKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdCdWlsZGluZyBpbnRlcmZhY2U6ICcgKyBuYW1lKTtcblxuICAgICAgICAgICAgbGV0IGFzdEJvZHkgPSBbXG4gICAgICAgICAgICAgICAgSnNMYW5nLmFzdFZhckRlY2xhcmUoJyRtZXRhJywgSnNMYW5nLmFzdFZhclJlZigndGhpcy5tZXRhLmludGVyZmFjZXMuJyArIG5hbWUpLCB0cnVlLCBmYWxzZSwgJ1JldHJpZXZpbmcgdGhlIG1ldGEgZGF0YScpXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBsZXQgY29tcGlsZUNvbnRleHQgPSBPb2xUb0FzdC5jcmVhdGVDb21waWxlQ29udGV4dChlbnRpdHkub29sTW9kdWxlLm5hbWUsIHRoaXMubG9nZ2VyLCBzaGFyZWRDb250ZXh0KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHBhcmFtTWV0YTtcblxuICAgICAgICAgICAgaWYgKG1ldGhvZC5hY2NlcHQpIHtcbiAgICAgICAgICAgICAgICBwYXJhbU1ldGEgPSB0aGlzLl9wcm9jZXNzUGFyYW1zKG1ldGhvZC5hY2NlcHQsIGNvbXBpbGVDb250ZXh0KTtcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcblxuICAgICAgICAgICAgLy9tZXRhZGF0YVxuICAgICAgICAgICAgbW9kZWxNZXRhSW5pdFsnaW50ZXJmYWNlcyddIHx8IChtb2RlbE1ldGFJbml0WydpbnRlcmZhY2VzJ10gPSB7fSk7XG4gICAgICAgICAgICBtb2RlbE1ldGFJbml0WydpbnRlcmZhY2VzJ11bbmFtZV0gPSB7IHBhcmFtczogT2JqZWN0LnZhbHVlcyhwYXJhbU1ldGEpIH07XG5cbiAgICAgICAgICAgIF8uZWFjaChtZXRob2QuaW1wbGVtZW50YXRpb24sIChvcGVyYXRpb24sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgLy9sZXQgbGFzdFRvcG9JZCA9IFxuICAgICAgICAgICAgICAgIE9vbFRvQXN0LmNvbXBpbGVEYk9wZXJhdGlvbihpbmRleCwgb3BlcmF0aW9uLCBjb21waWxlQ29udGV4dCwgY29tcGlsZUNvbnRleHQubWFpblN0YXJ0SWQpOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAobWV0aG9kLnJldHVybikge1xuICAgICAgICAgICAgICAgIE9vbFRvQXN0LmNvbXBpbGVFeGNlcHRpb25hbFJldHVybihtZXRob2QucmV0dXJuLCBjb21waWxlQ29udGV4dCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBkZXBzID0gY29tcGlsZUNvbnRleHQudG9wb1NvcnQuc29ydCgpO1xuICAgICAgICAgICAgLy90aGlzLmxvZ2dlci52ZXJib3NlKCdBbGwgZGVwZW5kZW5jaWVzOlxcbicgKyBKU09OLnN0cmluZ2lmeShkZXBzLCBudWxsLCAyKSk7XG5cbiAgICAgICAgICAgIGRlcHMgPSBkZXBzLmZpbHRlcihkZXAgPT4gY29tcGlsZUNvbnRleHQubWFwT2ZUb2tlblRvTWV0YS5oYXMoZGVwKSk7XG4gICAgICAgICAgICAvL3RoaXMubG9nZ2VyLnZlcmJvc2UoJ0FsbCBuZWNlc3Nhcnkgc291cmNlIGNvZGU6XFxuJyArIEpTT04uc3RyaW5naWZ5KGRlcHMsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgXy5lYWNoKGRlcHMsIGRlcCA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHNvdXJjZU1hcCA9IGNvbXBpbGVDb250ZXh0Lm1hcE9mVG9rZW5Ub01ldGEuZ2V0KGRlcCk7XG4gICAgICAgICAgICAgICAgbGV0IGFzdEJsb2NrID0gY29tcGlsZUNvbnRleHQuYXN0TWFwW2RlcF07XG5cbiAgICAgICAgICAgICAgICAvL3RoaXMubG9nZ2VyLnZlcmJvc2UoJ0NvZGUgcG9pbnQgXCInICsgZGVwICsgJ1wiOlxcbicgKyBKU09OLnN0cmluZ2lmeShzb3VyY2VNYXAsIG51bGwsIDIpKTtcblxuICAgICAgICAgICAgICAgIGxldCB0YXJnZXRGaWVsZE5hbWUgPSBzb3VyY2VNYXAudGFyZ2V0OyAvL2dldEZpZWxkTmFtZShzb3VyY2VNYXAudGFyZ2V0KTsgICAgICBcblxuICAgICAgICAgICAgICAgIGlmIChzb3VyY2VNYXAudHlwZSA9PT0gT29sVG9Bc3QuQVNUX0JMS19WQUxJREFUT1JfQ0FMTCkgeyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGFzdEJsb2NrID0gU25pcHBldHMuX3ZhbGlkYXRlQ2hlY2sodGFyZ2V0RmllbGROYW1lLCBhc3RCbG9jayk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNvdXJjZU1hcC50eXBlID09PSBPb2xUb0FzdC5BU1RfQkxLX1BST0NFU1NPUl9DQUxMKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzb3VyY2VNYXAubmVlZERlY2xhcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzdEJsb2NrID0gSnNMYW5nLmFzdFZhckRlY2xhcmUoSnNMYW5nLmFzdFZhclJlZihzb3VyY2VNYXAudGFyZ2V0KSwgYXN0QmxvY2ssIGZhbHNlLCBmYWxzZSwgYFByb2Nlc3NpbmcgXCIke3RhcmdldEZpZWxkTmFtZX1cImApOyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhc3RCbG9jayA9IEpzTGFuZy5hc3RBc3NpZ24oSnNMYW5nLmFzdFZhclJlZihzb3VyY2VNYXAudGFyZ2V0LCB0cnVlKSwgYXN0QmxvY2ssIGBQcm9jZXNzaW5nIFwiJHt0YXJnZXRGaWVsZE5hbWV9XCJgKTsgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc291cmNlTWFwLnR5cGUgPT09IE9vbFRvQXN0LkFTVF9CTEtfQUNUSVZBVE9SX0NBTEwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZU1hcC5uZWVkRGVjbGFyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXN0QmxvY2sgPSBKc0xhbmcuYXN0VmFyRGVjbGFyZShKc0xhbmcuYXN0VmFyUmVmKHNvdXJjZU1hcC50YXJnZXQpLCBhc3RCbG9jaywgZmFsc2UsIGZhbHNlLCBgUHJvY2Vzc2luZyBcIiR7dGFyZ2V0RmllbGROYW1lfVwiYCk7ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzdEJsb2NrID0gSnNMYW5nLmFzdEFzc2lnbihKc0xhbmcuYXN0VmFyUmVmKHNvdXJjZU1hcC50YXJnZXQsIHRydWUpLCBhc3RCbG9jaywgYEFjdGl2YXRpbmcgXCIke3RhcmdldEZpZWxkTmFtZX1cImApOyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGFzdEJvZHkgPSBhc3RCb2R5LmNvbmNhdChfLmNhc3RBcnJheShhc3RCbG9jaykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFzdC5wdXNoKEpzTGFuZy5hc3RNZW1iZXJNZXRob2QoYXN5bmNNZXRob2ROYW1pbmcobmFtZSksIE9iamVjdC5rZXlzKHBhcmFtTWV0YSksIGFzdEJvZHksIGZhbHNlLCB0cnVlLCB0cnVlLCByZXBsYWNlQWxsKF8ua2ViYWJDYXNlKG5hbWUpLCAnLScsICcgJykpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGFzdDtcbiAgICB9O1xuXG4gICAgX3Byb2Nlc3NQYXJhbXMoYWNjZXB0UGFyYW1zLCBjb21waWxlQ29udGV4dCkge1xuICAgICAgICBsZXQgcGFyYW1NZXRhID0ge307XG5cbiAgICAgICAgYWNjZXB0UGFyYW1zLmZvckVhY2goKHBhcmFtLCBpKSA9PiB7XG4gICAgICAgICAgICBPb2xUb0FzdC5jb21waWxlUGFyYW0oaSwgcGFyYW0sIGNvbXBpbGVDb250ZXh0KTtcbiAgICAgICAgICAgIHBhcmFtTWV0YVtwYXJhbS5uYW1lXSA9IHBhcmFtO1xuICAgICAgICAgICAgY29tcGlsZUNvbnRleHQudmFyaWFibGVzW3BhcmFtLm5hbWVdID0geyBzb3VyY2U6ICdhcmd1bWVudCcgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHBhcmFtTWV0YTtcbiAgICB9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IERhb01vZGVsZXI7Il19