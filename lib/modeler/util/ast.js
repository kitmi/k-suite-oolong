"use strict";

require("source-map-support/register");

const {
  _
} = require('rk-utils');

const escodegen = require('escodegen');

const AST_OBJECT_TYPES = ['ThisExpression', 'MemberExpression', 'BinaryExpression', 'UnaryExpression', 'ArrowFunctionExpression', 'FunctionExpression', 'ArrayExpression', 'ObjectExpression', 'CallExpression', 'YieldExpression', 'AwaitExpression', 'AssignmentExpression', 'Literal', 'Identifier'];

function astParams(params) {
  params = Array.isArray(params) ? params : [params];
  return params.map(p => {
    if (typeof p === 'string') {
      return astId(p);
    }

    if (_.isPlainObject(p)) {
      if (p.type === 'Identifier' || p.type === 'AssignmentPattern') {
        return p;
      }

      if (p.oolType === 'Parameter') {
        if (p.defaultValue) {
          return {
            "type": "AssignmentPattern",
            "left": {
              "type": "Identifier",
              "name": p.name
            },
            "right": astLiteral(p.defaultValue)
          };
        }

        return astId(p.name);
      }
    }

    throw new Error('Invalid param: ' + JSON.stringify(p));
  });
}

function mapArgs(args) {
  args = Array.isArray(args) ? args : [args];
  if (_.isEmpty(args)) return [];
  return args.map(a => {
    if (_.isPlainObject(a) && 'type' in a) {
      return a;
    }

    return astValue(a);
  });
}

function mapBody(body) {
  if (Array.isArray(body)) {
    return astBlock(body);
  }

  if (_.isPlainObject(body) && 'type' in body) {
    return body;
  }

  return astValue(body);
}

function astProgram(strict = true) {
  return {
    "type": "Program",
    "body": strict ? [astExpression(astValue('use strict'))] : [],
    "sourceType": "script"
  };
}

function astRequire(varName, requirePath, isObjDestruct = false) {
  return {
    "type": "VariableDeclaration",
    "declarations": [{
      "type": "VariableDeclarator",
      "id": isObjDestruct ? astObjPat(varName) : astId(varName),
      "init": astCall('require', [astValue(requirePath)])
    }],
    "kind": "const"
  };
}

function astLeadingComments(comment, type = 'Line') {
  return comment ? {
    "leadingComments": [{
      "type": type,
      "value": comment,
      "range": [1, comment.length + 3]
    }]
  } : {};
}

function astVarDeclare(left, right, isConstant = false, isObjDestruct = false, comment = false) {
  return {
    "type": "VariableDeclaration",
    "declarations": [{
      "type": "VariableDeclarator",
      "id": isObjDestruct ? astObjPat(left) : astId(left),
      "init": _.isNil(right) ? null : astValue(right)
    }],
    "kind": isConstant ? "const" : "let",
    ...astLeadingComments(comment)
  };
}

function astClassDeclare(className, superClassName, body, comment = false) {
  let ast = {
    "type": "ClassDeclaration",
    "id": astId(className),
    ...(comment ? astLeadingComments(`*\n * ${comment}\n * @class\n `, 'Block') : {})
  };

  if (superClassName) {
    ast['superClass'] = astId(superClassName);
  }

  ast['body'] = {
    "type": "ClassBody",
    "body": body ? Array.isArray(body) ? body : [body] : []
  };
  return ast;
}

function astMemberMethod(name, params, body, generator = false, async = false, isStatic = false, comment = false) {
  return {
    "type": "MethodDefinition",
    "key": astId(name),
    "computed": false,
    "value": astAnonymousFunction(params, body, generator, async),
    "kind": "method",
    "static": isStatic,
    ...(comment ? astLeadingComments(`*\n * ${comment}${params.map(p => `\n * @param ${p}`).join('')}${Array.isArray(body) && _.last(body).type === 'ReturnStatement' ? '\n * @returns {*}' : ''}\n `, 'Block') : {})
  };
}

function astIf(test, consequent, alternate, comment = false) {
  return {
    "type": "IfStatement",
    "test": astValue(test),
    "consequent": mapBody(consequent),
    "alternate": _.isNil(alternate) ? null : mapBody(alternate),
    ...astLeadingComments(comment)
  };
}

function astBinExp(left, operator, right) {
  return {
    "type": "BinaryExpression",
    "operator": operator,
    "left": astValue(left),
    "right": astValue(right)
  };
}

function astLogicalExp(left, operator, right) {
  return {
    "type": "LogicalExpression",
    "operator": operator,
    "left": astValue(left),
    "right": astValue(right)
  };
}

function astCall(functionName, args) {
  return {
    "type": "CallExpression",
    "callee": _.isPlainObject(functionName) ? functionName : astVarRef(functionName),
    "arguments": mapArgs(args)
  };
}

function astYield(target, delegate = false) {
  return {
    "type": "YieldExpression",
    "argument": target,
    "delegate": delegate
  };
}

function astAwait(functionName, args) {
  return {
    "type": "AwaitExpression",
    "argument": astCall(functionName, args)
  };
}

function astArrayAccess(name, index) {
  return {
    "type": "MemberExpression",
    "computed": true,
    "object": astVarRef(name),
    "property": {
      "type": "Literal",
      "value": index,
      "raw": `${index}`
    }
  };
}

function astVarRef(name, elementStyle = false) {
  if (_.isPlainObject(name)) {
    if (name.type === 'MemberExpression' || name.type === 'Identifier') {
      return name;
    }

    if (name.oolType === 'ObjectReference') {
      return astVarRef(name.name, elementStyle);
    }

    throw new Error('Invalid reference: ' + JSON.stringify(name));
  }

  let p = name.split('.');

  if (p.length > 1) {
    let result = {
      "type": "MemberExpression",
      "computed": elementStyle,
      "property": elementStyle ? astLiteral(p.pop()) : astId(p.pop())
    };
    let last = result;

    while (p.length > 1) {
      last["object"] = {
        "type": "MemberExpression",
        "computed": elementStyle,
        "property": elementStyle ? astLiteral(p.pop()) : astId(p.pop())
      };
      last = last["object"];
    }

    last["object"] = p[0] === 'this' ? astThis() : astId(p[0]);
    return result;
  } else {
    return astId(name);
  }
}

function astThis() {
  return {
    "type": "ThisExpression"
  };
}

function astId(name) {
  if (typeof name === 'string') {
    return {
      "type": "Identifier",
      "name": name
    };
  } else if (_.isPlainObject(name) && name.type === 'Identifier') {
    return name;
  }

  throw new Error('Invalid identifier name: ' + JSON.stringify(name));
}

function astObjPat(keys) {
  return {
    "type": "ObjectPattern",
    "properties": _.map(keys, k => ({
      "type": "Property",
      "key": astId(k),
      "computed": false,
      "value": astId(k),
      "kind": "init",
      "method": false,
      "shorthand": true
    }))
  };
}

function astMember(key, any, shorthand = false) {
  return {
    "type": "Property",
    "key": astId(key),
    "computed": false,
    "value": any,
    "kind": "init",
    "method": false,
    "shorthand": shorthand
  };
}

function astValue(value) {
  if (Array.isArray(value)) {
    return {
      "type": "ArrayExpression",
      "elements": _.map(value, e => astValue(e))
    };
  }

  if (_.isPlainObject(value)) {
    if (AST_OBJECT_TYPES.indexOf(value.type) !== -1) {
      return value;
    }

    if (value.oolType === 'ObjectReference') {
      return astVarRef(value.name, true);
    }

    let props = [];

    _.forOwn(value, (any, key) => {
      props.push(astMember(key, astValue(any)));
    });

    return {
      "type": "ObjectExpression",
      "properties": props
    };
  }

  if (_.isObject(value)) {
    throw new Error('Only plain object supported. Given: ' + JSON.stringify(value));
  }

  return astLiteral(value);
}

function astLiteral(value) {
  return {
    "type": "Literal",
    "value": value,
    "raw": JSON.stringify(value)
  };
}

function astAddMember(obj, member) {
  obj.properties.push(member);
}

function astPushInBody(obj, expr) {
  if (Array.isArray(obj.body)) {
    obj.body = obj.body.concat(_.castArray(expr));
  } else {
    obj.body.body = obj.body.body.concat(_.castArray(expr));
  }
}

function astFunction(name, params, body, generator = false, async = false) {
  return {
    "type": "FunctionDeclaration",
    "id": astId(name),
    "generator": generator,
    "expression": false,
    "async": async,
    "defaults": [],
    "params": astParams(params),
    "body": astBlock(body)
  };
}

function astAnonymousFunction(params, body, generator = false, async = false) {
  return {
    "type": "FunctionExpression",
    "id": null,
    "params": astParams(params),
    "defaults": [],
    "body": astBlock(body),
    "generator": generator,
    "expression": false,
    "async": async
  };
}

function astArrowFunction(params, body, generator = false, async = false) {
  return {
    "type": "ArrowFunctionExpression",
    "id": null,
    "params": astParams(params),
    "body": mapBody(body),
    "generator": generator,
    "expression": true,
    "async": async
  };
}

function astBlock(body) {
  return {
    "type": "BlockStatement",
    "body": Array.isArray(body) ? body : [body]
  };
}

function astMatchObject(idList, right, isConstant = true) {
  return {
    "type": "VariableDeclaration",
    "declarations": [{
      "type": "VariableDeclarator",
      "id": {
        "type": "ObjectPattern",
        "properties": _.map(idList, id => astMember(id, astId(id), true))
      },
      "init": right
    }],
    "kind": isConstant ? "const" : "let"
  };
}

function astExpression(expr, comment = false) {
  return {
    "type": "ExpressionStatement",
    "expression": expr,
    ...astLeadingComments(comment)
  };
}

function astAssign(left, right, comment = false) {
  return astExpression({
    "type": "AssignmentExpression",
    "operator": "=",
    "left": astVarRef(left),
    "right": astValue(right)
  }, comment);
}

function astConditional(test, consequent, alternate) {
  return {
    "type": "ConditionalExpression",
    "test": astValue(test),
    "consequent": astValue(consequent),
    "alternate": astValue(alternate)
  };
}

function astThrow(name, args) {
  return {
    "type": "ThrowStatement",
    "argument": {
      "type": "NewExpression",
      "callee": astVarRef(name),
      "arguments": mapArgs(args)
    }
  };
}

function astNot(expr) {
  return {
    "type": "UnaryExpression",
    "operator": "!",
    "argument": astValue(expr),
    "prefix": true
  };
}

function astReturn(val) {
  return {
    "type": "ReturnStatement",
    "argument": astValue(val)
  };
}

function astToCode(ast) {
  return escodegen.generate(ast, {
    format: {
      indent: {
        style: '    ',
        base: 0,
        adjustMultilineComment: false
      },
      newline: '\n',
      space: ' ',
      json: false,
      renumber: false,
      hexadecimal: false,
      quotes: 'single',
      escapeless: false,
      compact: false,
      parentheses: true,
      semicolons: true,
      safeConcatenation: false
    },
    comment: true
  });
}

module.exports = {
  astProgram,
  astRequire,
  astVarDeclare,
  astClassDeclare,
  astMemberMethod,
  astCall,
  astYield,
  astAwait,
  astThis,
  astId,
  astVarRef,
  astValue,
  astFunction,
  astAnonymousFunction,
  astArrowFunction,
  astIf,
  astConditional,
  astBinExp,
  astLogicalExp,
  astBlock,
  astMatchObject,
  astExpression,
  astAssign,
  astAddMember,
  astMember,
  astPushInBody,
  astThrow,
  astNot,
  astReturn,
  astLiteral,
  astParams,
  astArrayAccess,
  astToCode
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlbGVyL3V0aWwvYXN0LmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwiZXNjb2RlZ2VuIiwiQVNUX09CSkVDVF9UWVBFUyIsImFzdFBhcmFtcyIsInBhcmFtcyIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsInAiLCJhc3RJZCIsImlzUGxhaW5PYmplY3QiLCJ0eXBlIiwib29sVHlwZSIsImRlZmF1bHRWYWx1ZSIsIm5hbWUiLCJhc3RMaXRlcmFsIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwibWFwQXJncyIsImFyZ3MiLCJpc0VtcHR5IiwiYSIsImFzdFZhbHVlIiwibWFwQm9keSIsImJvZHkiLCJhc3RCbG9jayIsImFzdFByb2dyYW0iLCJzdHJpY3QiLCJhc3RFeHByZXNzaW9uIiwiYXN0UmVxdWlyZSIsInZhck5hbWUiLCJyZXF1aXJlUGF0aCIsImlzT2JqRGVzdHJ1Y3QiLCJhc3RPYmpQYXQiLCJhc3RDYWxsIiwiYXN0TGVhZGluZ0NvbW1lbnRzIiwiY29tbWVudCIsImxlbmd0aCIsImFzdFZhckRlY2xhcmUiLCJsZWZ0IiwicmlnaHQiLCJpc0NvbnN0YW50IiwiaXNOaWwiLCJhc3RDbGFzc0RlY2xhcmUiLCJjbGFzc05hbWUiLCJzdXBlckNsYXNzTmFtZSIsImFzdCIsImFzdE1lbWJlck1ldGhvZCIsImdlbmVyYXRvciIsImFzeW5jIiwiaXNTdGF0aWMiLCJhc3RBbm9ueW1vdXNGdW5jdGlvbiIsImpvaW4iLCJsYXN0IiwiYXN0SWYiLCJ0ZXN0IiwiY29uc2VxdWVudCIsImFsdGVybmF0ZSIsImFzdEJpbkV4cCIsIm9wZXJhdG9yIiwiYXN0TG9naWNhbEV4cCIsImZ1bmN0aW9uTmFtZSIsImFzdFZhclJlZiIsImFzdFlpZWxkIiwidGFyZ2V0IiwiZGVsZWdhdGUiLCJhc3RBd2FpdCIsImFzdEFycmF5QWNjZXNzIiwiaW5kZXgiLCJlbGVtZW50U3R5bGUiLCJzcGxpdCIsInJlc3VsdCIsInBvcCIsImFzdFRoaXMiLCJrZXlzIiwiayIsImFzdE1lbWJlciIsImtleSIsImFueSIsInNob3J0aGFuZCIsInZhbHVlIiwiZSIsImluZGV4T2YiLCJwcm9wcyIsImZvck93biIsInB1c2giLCJpc09iamVjdCIsImFzdEFkZE1lbWJlciIsIm9iaiIsIm1lbWJlciIsInByb3BlcnRpZXMiLCJhc3RQdXNoSW5Cb2R5IiwiZXhwciIsImNvbmNhdCIsImNhc3RBcnJheSIsImFzdEZ1bmN0aW9uIiwiYXN0QXJyb3dGdW5jdGlvbiIsImFzdE1hdGNoT2JqZWN0IiwiaWRMaXN0IiwiaWQiLCJhc3RBc3NpZ24iLCJhc3RDb25kaXRpb25hbCIsImFzdFRocm93IiwiYXN0Tm90IiwiYXN0UmV0dXJuIiwidmFsIiwiYXN0VG9Db2RlIiwiZ2VuZXJhdGUiLCJmb3JtYXQiLCJpbmRlbnQiLCJzdHlsZSIsImJhc2UiLCJhZGp1c3RNdWx0aWxpbmVDb21tZW50IiwibmV3bGluZSIsInNwYWNlIiwianNvbiIsInJlbnVtYmVyIiwiaGV4YWRlY2ltYWwiLCJxdW90ZXMiLCJlc2NhcGVsZXNzIiwiY29tcGFjdCIsInBhcmVudGhlc2VzIiwic2VtaWNvbG9ucyIsInNhZmVDb25jYXRlbmF0aW9uIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFPQSxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBUUMsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FBQ0EsTUFBTUMsU0FBUyxHQUFHRCxPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFFQSxNQUFNRSxnQkFBZ0IsR0FBRyxDQUNyQixnQkFEcUIsRUFFckIsa0JBRnFCLEVBR3JCLGtCQUhxQixFQUlyQixpQkFKcUIsRUFLckIseUJBTHFCLEVBTXJCLG9CQU5xQixFQU9yQixpQkFQcUIsRUFRckIsa0JBUnFCLEVBU3JCLGdCQVRxQixFQVVyQixpQkFWcUIsRUFXckIsaUJBWHFCLEVBWXJCLHNCQVpxQixFQWFyQixTQWJxQixFQWNyQixZQWRxQixDQUF6Qjs7QUFpQkEsU0FBU0MsU0FBVCxD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QjtBQUNibkcsRUFBQUEsVUFEYTtBQUViRyxFQUFBQSxVQUZhO0FBR2JTLEVBQUFBLGFBSGE7QUFJYkssRUFBQUEsZUFKYTtBQUtiSSxFQUFBQSxlQUxhO0FBTWJiLEVBQUFBLE9BTmE7QUFPYjZCLEVBQUFBLFFBUGE7QUFRYkcsRUFBQUEsUUFSYTtBQVNiTyxFQUFBQSxPQVRhO0FBVWJqRSxFQUFBQSxLQVZhO0FBV2JzRCxFQUFBQSxTQVhhO0FBWWJ4QyxFQUFBQSxRQVphO0FBYWJ5RSxFQUFBQSxXQWJhO0FBY2I1QyxFQUFBQSxvQkFkYTtBQWViNkMsRUFBQUEsZ0JBZmE7QUFnQmIxQyxFQUFBQSxLQWhCYTtBQWlCYitDLEVBQUFBLGNBakJhO0FBa0JiM0MsRUFBQUEsU0FsQmE7QUFtQmJFLEVBQUFBLGFBbkJhO0FBb0JibkMsRUFBQUEsUUFwQmE7QUFxQmJ3RSxFQUFBQSxjQXJCYTtBQXNCYnJFLEVBQUFBLGFBdEJhO0FBdUJid0UsRUFBQUEsU0F2QmE7QUF3QmJiLEVBQUFBLFlBeEJhO0FBeUJiWCxFQUFBQSxTQXpCYTtBQTBCYmUsRUFBQUEsYUExQmE7QUEyQmJXLEVBQUFBLFFBM0JhO0FBNEJiQyxFQUFBQSxNQTVCYTtBQTZCYkMsRUFBQUEsU0E3QmE7QUE4QmIxRixFQUFBQSxVQTlCYTtBQStCYlosRUFBQUEsU0EvQmE7QUFnQ2JpRSxFQUFBQSxjQWhDYTtBQWlDYnVDLEVBQUFBO0FBakNhLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQG1vZHVsZVxuICogQGlnbm9yZVxuICovXG5cbmNvbnN0IHsgXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IGVzY29kZWdlbiA9IHJlcXVpcmUoJ2VzY29kZWdlbicpO1xuXG5jb25zdCBBU1RfT0JKRUNUX1RZUEVTID0gW1xuICAgICdUaGlzRXhwcmVzc2lvbicsXG4gICAgJ01lbWJlckV4cHJlc3Npb24nLFxuICAgICdCaW5hcnlFeHByZXNzaW9uJyxcbiAgICAnVW5hcnlFeHByZXNzaW9uJyxcbiAgICAnQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24nLFxuICAgICdGdW5jdGlvbkV4cHJlc3Npb24nLFxuICAgICdBcnJheUV4cHJlc3Npb24nLFxuICAgICdPYmplY3RFeHByZXNzaW9uJyxcbiAgICAnQ2FsbEV4cHJlc3Npb24nLFxuICAgICdZaWVsZEV4cHJlc3Npb24nLFxuICAgICdBd2FpdEV4cHJlc3Npb24nLFxuICAgICdBc3NpZ25tZW50RXhwcmVzc2lvbicsXG4gICAgJ0xpdGVyYWwnLFxuICAgICdJZGVudGlmaWVyJ1xuXTtcblxuZnVuY3Rpb24gYXN0UGFyYW1zKHBhcmFtcykge1xuICAgIHBhcmFtcyA9IEFycmF5LmlzQXJyYXkocGFyYW1zKSA/IHBhcmFtcyA6IFsgcGFyYW1zIF07XG5cbiAgICByZXR1cm4gcGFyYW1zLm1hcChwID0+IHtcbiAgICAgICAgIGlmICh0eXBlb2YgcCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICByZXR1cm4gYXN0SWQocCk7XG4gICAgICAgICB9XG5cbiAgICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChwKSkge1xuICAgICAgICAgICAgaWYgKHAudHlwZSA9PT0gJ0lkZW50aWZpZXInIHx8IHAudHlwZSA9PT0gJ0Fzc2lnbm1lbnRQYXR0ZXJuJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocC5vb2xUeXBlID09PSAnUGFyYW1ldGVyJykge1xuICAgICAgICAgICAgICAgIGlmIChwLmRlZmF1bHRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiQXNzaWdubWVudFBhdHRlcm5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGVmdFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiSWRlbnRpZmllclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBwLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJpZ2h0XCI6IGFzdExpdGVyYWwocC5kZWZhdWx0VmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFzdElkKHAubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcGFyYW06ICcgKyBKU09OLnN0cmluZ2lmeShwKSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIG1hcEFyZ3MoYXJncykge1xuICAgIGFyZ3MgPSBBcnJheS5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFsgYXJncyBdO1xuXG4gICAgaWYgKF8uaXNFbXB0eShhcmdzKSkgcmV0dXJuIFtdO1xuXG4gICAgcmV0dXJuIGFyZ3MubWFwKGEgPT4ge1xuICAgICAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGEpICYmICd0eXBlJyBpbiBhKSB7XG4gICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhc3RWYWx1ZShhKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gbWFwQm9keShib2R5KSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYm9keSkpIHtcbiAgICAgICAgcmV0dXJuIGFzdEJsb2NrKGJvZHkpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KGJvZHkpICYmICd0eXBlJyBpbiBib2R5KSB7XG4gICAgICAgIHJldHVybiBib2R5O1xuICAgIH1cblxuICAgIHJldHVybiBhc3RWYWx1ZShib2R5KTtcbn1cblxuZnVuY3Rpb24gYXN0UHJvZ3JhbShzdHJpY3QgPSB0cnVlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiUHJvZ3JhbVwiLFxuICAgICAgICBcImJvZHlcIjogc3RyaWN0ID8gW2FzdEV4cHJlc3Npb24oYXN0VmFsdWUoJ3VzZSBzdHJpY3QnKSldIDogW10sXG4gICAgICAgIFwic291cmNlVHlwZVwiOiBcInNjcmlwdFwiXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYXN0UmVxdWlyZSh2YXJOYW1lLCByZXF1aXJlUGF0aCwgaXNPYmpEZXN0cnVjdCA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiVmFyaWFibGVEZWNsYXJhdGlvblwiLFxuICAgICAgICBcImRlY2xhcmF0aW9uc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiVmFyaWFibGVEZWNsYXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgXCJpZFwiOiBpc09iakRlc3RydWN0ID8gYXN0T2JqUGF0KHZhck5hbWUpIDogYXN0SWQodmFyTmFtZSksXG4gICAgICAgICAgICAgICAgXCJpbml0XCI6IGFzdENhbGwoJ3JlcXVpcmUnLCBbIGFzdFZhbHVlKHJlcXVpcmVQYXRoKSBdKVxuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcImtpbmRcIjogXCJjb25zdFwiXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYXN0TGVhZGluZ0NvbW1lbnRzKGNvbW1lbnQsIHR5cGUgPSAnTGluZScpIHtcbiAgICByZXR1cm4gY29tbWVudCA/IHsgXCJsZWFkaW5nQ29tbWVudHNcIjogW1xuICAgICAgICB7XG4gICAgICAgICAgICBcInR5cGVcIjogdHlwZSxcbiAgICAgICAgICAgIFwidmFsdWVcIjogY29tbWVudCxcbiAgICAgICAgICAgIFwicmFuZ2VcIjogW1xuICAgICAgICAgICAgICAgIDEsXG4gICAgICAgICAgICAgICAgY29tbWVudC5sZW5ndGgrM1xuICAgICAgICAgICAgXVxuICAgICAgICB9XG4gICAgXX0gOiB7fTtcbn1cblxuZnVuY3Rpb24gYXN0VmFyRGVjbGFyZShsZWZ0LCByaWdodCwgaXNDb25zdGFudCA9IGZhbHNlLCBpc09iakRlc3RydWN0ID0gZmFsc2UsIGNvbW1lbnQgPSBmYWxzZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIixcbiAgICAgICAgXCJkZWNsYXJhdGlvbnNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcIlZhcmlhYmxlRGVjbGFyYXRvclwiLFxuICAgICAgICAgICAgICAgIFwiaWRcIjogaXNPYmpEZXN0cnVjdCA/IGFzdE9ialBhdChsZWZ0KSA6IGFzdElkKGxlZnQpLFxuICAgICAgICAgICAgICAgIFwiaW5pdFwiOiBfLmlzTmlsKHJpZ2h0KSA/IG51bGwgOiBhc3RWYWx1ZShyaWdodClcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCJraW5kXCI6IGlzQ29uc3RhbnQgPyBcImNvbnN0XCIgOiBcImxldFwiLFxuICAgICAgICAuLi5hc3RMZWFkaW5nQ29tbWVudHMoY29tbWVudClcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBhc3RDbGFzc0RlY2xhcmUoY2xhc3NOYW1lLCBzdXBlckNsYXNzTmFtZSwgYm9keSwgY29tbWVudCA9IGZhbHNlKSB7XG4gICAgbGV0IGFzdCA9IHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiQ2xhc3NEZWNsYXJhdGlvblwiLFxuICAgICAgICBcImlkXCI6IGFzdElkKGNsYXNzTmFtZSksXG4gICAgICAgIC4uLihjb21tZW50ID8gYXN0TGVhZGluZ0NvbW1lbnRzKGAqXFxuICogJHtjb21tZW50fVxcbiAqIEBjbGFzc1xcbiBgLCAnQmxvY2snKSA6IHt9KVxuICAgIH07XG5cbiAgICBpZiAoc3VwZXJDbGFzc05hbWUpIHtcbiAgICAgICAgYXN0WydzdXBlckNsYXNzJ10gPSBhc3RJZChzdXBlckNsYXNzTmFtZSk7XG4gICAgfVxuXG4gICAgYXN0Wydib2R5J10gPSB7XG4gICAgICAgIFwidHlwZVwiOiBcIkNsYXNzQm9keVwiLFxuICAgICAgICBcImJvZHlcIjogYm9keSA/IChBcnJheS5pc0FycmF5KGJvZHkpID8gYm9keSA6IFsgYm9keSBdKSA6IFtdXG4gICAgfTtcblxuICAgIHJldHVybiBhc3Q7XG59XG5cbmZ1bmN0aW9uIGFzdE1lbWJlck1ldGhvZChuYW1lLCBwYXJhbXMsIGJvZHksIGdlbmVyYXRvciA9IGZhbHNlLCBhc3luYyA9IGZhbHNlLCBpc1N0YXRpYyA9IGZhbHNlLCBjb21tZW50ID0gZmFsc2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJNZXRob2REZWZpbml0aW9uXCIsXG4gICAgICAgIFwia2V5XCI6IGFzdElkKG5hbWUpLFxuICAgICAgICBcImNvbXB1dGVkXCI6IGZhbHNlLFxuICAgICAgICBcInZhbHVlXCI6IGFzdEFub255bW91c0Z1bmN0aW9uKHBhcmFtcywgYm9keSwgZ2VuZXJhdG9yLCBhc3luYyksXG4gICAgICAgIFwia2luZFwiOiBcIm1ldGhvZFwiLFxuICAgICAgICBcInN0YXRpY1wiOiBpc1N0YXRpYyxcbiAgICAgICAgLy9cIipcXG4gKiBcXG4gKiBAcGFyYW0gaWRlbnRpdHlcXG4gKiBAcGFyYW0gcGFzc3dvcmRcXG4gKiBAcmV0dXJucyB7Kn1cXG4gXCJcbiAgICAgICAgLi4uKGNvbW1lbnQgPyBhc3RMZWFkaW5nQ29tbWVudHMoYCpcXG4gKiAke2NvbW1lbnR9JHtwYXJhbXMubWFwKHAgPT4gYFxcbiAqIEBwYXJhbSAke3B9YCkuam9pbignJyl9JHtBcnJheS5pc0FycmF5KGJvZHkpICYmIF8ubGFzdChib2R5KS50eXBlID09PSAnUmV0dXJuU3RhdGVtZW50JyA/ICdcXG4gKiBAcmV0dXJucyB7Kn0nIDogJyd9XFxuIGAsICdCbG9jaycpIDoge30pXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYXN0SWYodGVzdCwgY29uc2VxdWVudCwgYWx0ZXJuYXRlLCBjb21tZW50ID0gZmFsc2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJJZlN0YXRlbWVudFwiLFxuICAgICAgICBcInRlc3RcIjogYXN0VmFsdWUodGVzdCksXG4gICAgICAgIFwiY29uc2VxdWVudFwiOiBtYXBCb2R5KGNvbnNlcXVlbnQpLFxuICAgICAgICBcImFsdGVybmF0ZVwiOiBfLmlzTmlsKGFsdGVybmF0ZSkgPyBudWxsIDogbWFwQm9keShhbHRlcm5hdGUpLFxuICAgICAgICAuLi5hc3RMZWFkaW5nQ29tbWVudHMoY29tbWVudClcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBhc3RCaW5FeHAobGVmdCwgb3BlcmF0b3IsIHJpZ2h0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiQmluYXJ5RXhwcmVzc2lvblwiLFxuICAgICAgICBcIm9wZXJhdG9yXCI6IG9wZXJhdG9yLFxuICAgICAgICBcImxlZnRcIjogYXN0VmFsdWUobGVmdCksXG4gICAgICAgIFwicmlnaHRcIjogYXN0VmFsdWUocmlnaHQpXG4gICAgfVxufVxuXG5mdW5jdGlvbiBhc3RMb2dpY2FsRXhwKGxlZnQsIG9wZXJhdG9yLCByaWdodCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIkxvZ2ljYWxFeHByZXNzaW9uXCIsXG4gICAgICAgIFwib3BlcmF0b3JcIjogb3BlcmF0b3IsXG4gICAgICAgIFwibGVmdFwiOiBhc3RWYWx1ZShsZWZ0KSxcbiAgICAgICAgXCJyaWdodFwiOiBhc3RWYWx1ZShyaWdodClcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFzdENhbGwoZnVuY3Rpb25OYW1lLCBhcmdzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiQ2FsbEV4cHJlc3Npb25cIixcbiAgICAgICAgXCJjYWxsZWVcIjogXy5pc1BsYWluT2JqZWN0KGZ1bmN0aW9uTmFtZSkgPyBmdW5jdGlvbk5hbWUgOiBhc3RWYXJSZWYoZnVuY3Rpb25OYW1lKSxcbiAgICAgICAgXCJhcmd1bWVudHNcIjogbWFwQXJncyhhcmdzKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdFlpZWxkKHRhcmdldCwgZGVsZWdhdGUgPSBmYWxzZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIllpZWxkRXhwcmVzc2lvblwiLFxuICAgICAgICBcImFyZ3VtZW50XCI6IHRhcmdldCxcbiAgICAgICAgXCJkZWxlZ2F0ZVwiOiBkZWxlZ2F0ZVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdEF3YWl0KGZ1bmN0aW9uTmFtZSwgYXJncykge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIkF3YWl0RXhwcmVzc2lvblwiLFxuICAgICAgICBcImFyZ3VtZW50XCI6IGFzdENhbGwoZnVuY3Rpb25OYW1lLCBhcmdzKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdEFycmF5QWNjZXNzKG5hbWUsIGluZGV4KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiTWVtYmVyRXhwcmVzc2lvblwiLFxuICAgICAgICBcImNvbXB1dGVkXCI6IHRydWUsXG4gICAgICAgIFwib2JqZWN0XCI6IGFzdFZhclJlZihuYW1lKSxcbiAgICAgICAgXCJwcm9wZXJ0eVwiOiB7XG4gICAgICAgICAgICBcInR5cGVcIjogXCJMaXRlcmFsXCIsXG4gICAgICAgICAgICBcInZhbHVlXCI6IGluZGV4LFxuICAgICAgICAgICAgXCJyYXdcIjogYCR7aW5kZXh9YFxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhc3RWYXJSZWYobmFtZSwgZWxlbWVudFN0eWxlID0gZmFsc2UpIHtcbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KG5hbWUpKSB7XG4gICAgICAgIGlmIChuYW1lLnR5cGUgPT09ICdNZW1iZXJFeHByZXNzaW9uJyB8fCBuYW1lLnR5cGUgPT09ICdJZGVudGlmaWVyJykge1xuICAgICAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmFtZS5vb2xUeXBlID09PSAnT2JqZWN0UmVmZXJlbmNlJykge1xuICAgICAgICAgICAgcmV0dXJuIGFzdFZhclJlZihuYW1lLm5hbWUsIGVsZW1lbnRTdHlsZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgcmVmZXJlbmNlOiAnICsgSlNPTi5zdHJpbmdpZnkobmFtZSkpO1xuICAgIH1cblxuICAgIGxldCBwID0gbmFtZS5zcGxpdCgnLicpO1xuICAgIGlmIChwLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgLy9wLnJldmVyc2UoKTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIk1lbWJlckV4cHJlc3Npb25cIixcbiAgICAgICAgICAgIFwiY29tcHV0ZWRcIjogZWxlbWVudFN0eWxlLFxuICAgICAgICAgICAgXCJwcm9wZXJ0eVwiOiBlbGVtZW50U3R5bGUgPyBhc3RMaXRlcmFsKHAucG9wKCkpIDogYXN0SWQocC5wb3AoKSlcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgbGFzdCA9IHJlc3VsdDtcblxuICAgICAgICB3aGlsZSAocC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBsYXN0W1wib2JqZWN0XCJdID0ge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcIk1lbWJlckV4cHJlc3Npb25cIixcbiAgICAgICAgICAgICAgICBcImNvbXB1dGVkXCI6IGVsZW1lbnRTdHlsZSxcbiAgICAgICAgICAgICAgICBcInByb3BlcnR5XCI6IGVsZW1lbnRTdHlsZSA/IGFzdExpdGVyYWwocC5wb3AoKSkgOiBhc3RJZChwLnBvcCgpKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbGFzdCA9IGxhc3RbXCJvYmplY3RcIl07XG4gICAgICAgIH1cblxuICAgICAgICBsYXN0W1wib2JqZWN0XCJdID0gcFswXSA9PT0gJ3RoaXMnIFxuICAgICAgICAgICAgPyBhc3RUaGlzKClcbiAgICAgICAgICAgIDogYXN0SWQocFswXSk7XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYXN0SWQobmFtZSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhc3RUaGlzKCkge1xuICAgIHJldHVybiB7IFwidHlwZVwiOiBcIlRoaXNFeHByZXNzaW9uXCIgfTtcbn1cblxuZnVuY3Rpb24gYXN0SWQobmFtZSkge1xuICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIklkZW50aWZpZXJcIixcbiAgICAgICAgICAgIFwibmFtZVwiOiBuYW1lXG4gICAgICAgIH07XG4gICAgfSBlbHNlIGlmIChfLmlzUGxhaW5PYmplY3QobmFtZSkgJiYgbmFtZS50eXBlID09PSAnSWRlbnRpZmllcicpIHtcbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGlkZW50aWZpZXIgbmFtZTogJyArIEpTT04uc3RyaW5naWZ5KG5hbWUpKTtcbn1cblxuZnVuY3Rpb24gYXN0T2JqUGF0KGtleXMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJPYmplY3RQYXR0ZXJuXCIsXG4gICAgICAgIFwicHJvcGVydGllc1wiOiBfLm1hcChrZXlzLCAoaykgPT4gKHtcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIlByb3BlcnR5XCIsXG4gICAgICAgICAgICBcImtleVwiOiBhc3RJZChrKSxcbiAgICAgICAgICAgIFwiY29tcHV0ZWRcIjogZmFsc2UsXG4gICAgICAgICAgICBcInZhbHVlXCI6IGFzdElkKGspLFxuICAgICAgICAgICAgXCJraW5kXCI6IFwiaW5pdFwiLFxuICAgICAgICAgICAgXCJtZXRob2RcIjogZmFsc2UsXG4gICAgICAgICAgICBcInNob3J0aGFuZFwiOiB0cnVlXG4gICAgICAgIH0pKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdE1lbWJlcihrZXksIGFueSwgc2hvcnRoYW5kID0gZmFsc2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJQcm9wZXJ0eVwiLFxuICAgICAgICBcImtleVwiOiBhc3RJZChrZXkpLFxuICAgICAgICBcImNvbXB1dGVkXCI6IGZhbHNlLFxuICAgICAgICBcInZhbHVlXCI6IGFueSxcbiAgICAgICAgXCJraW5kXCI6IFwiaW5pdFwiLFxuICAgICAgICBcIm1ldGhvZFwiOiBmYWxzZSxcbiAgICAgICAgXCJzaG9ydGhhbmRcIjogc2hvcnRoYW5kXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYXN0VmFsdWUodmFsdWUpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIkFycmF5RXhwcmVzc2lvblwiLFxuICAgICAgICAgICAgXCJlbGVtZW50c1wiOiBfLm1hcCh2YWx1ZSwgZSA9PiBhc3RWYWx1ZShlKSlcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc1BsYWluT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICBpZiAoQVNUX09CSkVDVF9UWVBFUy5pbmRleE9mKHZhbHVlLnR5cGUpICE9PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHZhbHVlLm9vbFR5cGUgPT09ICdPYmplY3RSZWZlcmVuY2UnKSB7XG4gICAgICAgICAgICByZXR1cm4gYXN0VmFyUmVmKHZhbHVlLm5hbWUsIHRydWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgLypcbiAgICAgICAgaWYgKHZhbHVlLnR5cGUgPT09ICdGdW5jdGlvbkNhbGwnKSB7XG4gICAgICAgICAgICByZXR1cm4gYXN0Q2FsbCh2YWx1ZS5uYW1lLCB2YWx1ZS5hcmdzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZS50eXBlID09PSAnRnVuY3RvcicpIHtcbiAgICAgICAgICAgIHJldHVybiBhc3RBcnJvd0Z1bmN0aW9uKHZhbHVlLmFyZ3MsIGFzdFZhbHVlKHZhbHVlLmJvZHkpLCBmYWxzZSwgdmFsdWUuYXN5bmMpO1xuICAgICAgICB9XG4gICAgICAgICovXG5cbiAgICAgICAgbGV0IHByb3BzID0gW107XG5cbiAgICAgICAgXy5mb3JPd24odmFsdWUsIChhbnksIGtleSkgPT4ge1xuICAgICAgICAgICAgcHJvcHMucHVzaChhc3RNZW1iZXIoa2V5LCBhc3RWYWx1ZShhbnkpKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBcInR5cGVcIjogXCJPYmplY3RFeHByZXNzaW9uXCIsXG4gICAgICAgICAgICBcInByb3BlcnRpZXNcIjogcHJvcHNcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoXy5pc09iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IHBsYWluIG9iamVjdCBzdXBwb3J0ZWQuIEdpdmVuOiAnICsgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXN0TGl0ZXJhbCh2YWx1ZSk7XG59XG5cbmZ1bmN0aW9uIGFzdExpdGVyYWwodmFsdWUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJMaXRlcmFsXCIsXG4gICAgICAgIFwidmFsdWVcIjogdmFsdWUsXG4gICAgICAgIFwicmF3XCI6IEpTT04uc3RyaW5naWZ5KHZhbHVlKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdEFkZE1lbWJlcihvYmosIG1lbWJlcikge1xuICAgIG9iai5wcm9wZXJ0aWVzLnB1c2gobWVtYmVyKTtcbn1cblxuZnVuY3Rpb24gYXN0UHVzaEluQm9keShvYmosIGV4cHIpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShvYmouYm9keSkpIHtcbiAgICAgICAgb2JqLmJvZHkgPSBvYmouYm9keS5jb25jYXQoXy5jYXN0QXJyYXkoZXhwcikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9iai5ib2R5LmJvZHkgPSBvYmouYm9keS5ib2R5LmNvbmNhdChfLmNhc3RBcnJheShleHByKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhc3RGdW5jdGlvbihuYW1lLCBwYXJhbXMsIGJvZHksIGdlbmVyYXRvciA9IGZhbHNlLCBhc3luYyA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiRnVuY3Rpb25EZWNsYXJhdGlvblwiLFxuICAgICAgICBcImlkXCI6IGFzdElkKG5hbWUpLFxuICAgICAgICBcImdlbmVyYXRvclwiOiBnZW5lcmF0b3IsXG4gICAgICAgIFwiZXhwcmVzc2lvblwiOiBmYWxzZSxcbiAgICAgICAgXCJhc3luY1wiOiBhc3luYyxcbiAgICAgICAgXCJkZWZhdWx0c1wiOiBbXSxcbiAgICAgICAgXCJwYXJhbXNcIjogYXN0UGFyYW1zKHBhcmFtcyksXG4gICAgICAgIFwiYm9keVwiOiBhc3RCbG9jayhib2R5KVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdEFub255bW91c0Z1bmN0aW9uKHBhcmFtcywgYm9keSwgZ2VuZXJhdG9yID0gZmFsc2UsIGFzeW5jID0gZmFsc2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJGdW5jdGlvbkV4cHJlc3Npb25cIixcbiAgICAgICAgXCJpZFwiOiBudWxsLFxuICAgICAgICBcInBhcmFtc1wiOiBhc3RQYXJhbXMocGFyYW1zKSxcbiAgICAgICAgXCJkZWZhdWx0c1wiOiBbXSxcbiAgICAgICAgXCJib2R5XCI6IGFzdEJsb2NrKGJvZHkpLFxuICAgICAgICBcImdlbmVyYXRvclwiOiBnZW5lcmF0b3IsXG4gICAgICAgIFwiZXhwcmVzc2lvblwiOiBmYWxzZSxcbiAgICAgICAgXCJhc3luY1wiOiBhc3luY1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdEFycm93RnVuY3Rpb24ocGFyYW1zLCBib2R5LCBnZW5lcmF0b3IgPSBmYWxzZSwgYXN5bmMgPSBmYWxzZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIkFycm93RnVuY3Rpb25FeHByZXNzaW9uXCIsXG4gICAgICAgIFwiaWRcIjogbnVsbCxcbiAgICAgICAgXCJwYXJhbXNcIjogYXN0UGFyYW1zKHBhcmFtcyksXG4gICAgICAgIFwiYm9keVwiOiBtYXBCb2R5KGJvZHkpLFxuICAgICAgICBcImdlbmVyYXRvclwiOiBnZW5lcmF0b3IsXG4gICAgICAgIFwiZXhwcmVzc2lvblwiOiB0cnVlLFxuICAgICAgICBcImFzeW5jXCI6IGFzeW5jXG4gICAgfVxufVxuXG5mdW5jdGlvbiBhc3RCbG9jayhib2R5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiQmxvY2tTdGF0ZW1lbnRcIixcbiAgICAgICAgXCJib2R5XCI6IEFycmF5LmlzQXJyYXkoYm9keSkgPyBib2R5IDogWyBib2R5IF1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiBhc3RNYXRjaE9iamVjdChpZExpc3QsIHJpZ2h0LCBpc0NvbnN0YW50ID0gdHJ1ZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIixcbiAgICAgICAgXCJkZWNsYXJhdGlvbnNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcIlZhcmlhYmxlRGVjbGFyYXRvclwiLFxuICAgICAgICAgICAgICAgIFwiaWRcIjoge1xuICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJPYmplY3RQYXR0ZXJuXCIsXG4gICAgICAgICAgICAgICAgICAgIFwicHJvcGVydGllc1wiOiBfLm1hcChpZExpc3QsIGlkID0+IGFzdE1lbWJlcihpZCwgYXN0SWQoaWQpLCB0cnVlKSlcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiaW5pdFwiOiByaWdodFxuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcImtpbmRcIjogaXNDb25zdGFudCA/IFwiY29uc3RcIiA6IFwibGV0XCJcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBhc3RFeHByZXNzaW9uKGV4cHIsIGNvbW1lbnQgPSBmYWxzZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFwidHlwZVwiOiBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIixcbiAgICAgICAgXCJleHByZXNzaW9uXCI6IGV4cHIsXG4gICAgICAgIC4uLmFzdExlYWRpbmdDb21tZW50cyhjb21tZW50KVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdEFzc2lnbihsZWZ0LCByaWdodCwgY29tbWVudCA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIGFzdEV4cHJlc3Npb24oe1xuICAgICAgICBcInR5cGVcIjogXCJBc3NpZ25tZW50RXhwcmVzc2lvblwiLFxuICAgICAgICBcIm9wZXJhdG9yXCI6IFwiPVwiLFxuICAgICAgICBcImxlZnRcIjogYXN0VmFyUmVmKGxlZnQpLFxuICAgICAgICBcInJpZ2h0XCI6IGFzdFZhbHVlKHJpZ2h0KVxuICAgIH0sIGNvbW1lbnQpO1xufVxuXG5mdW5jdGlvbiBhc3RDb25kaXRpb25hbCh0ZXN0LCBjb25zZXF1ZW50LCBhbHRlcm5hdGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJDb25kaXRpb25hbEV4cHJlc3Npb25cIixcbiAgICAgICAgXCJ0ZXN0XCI6IGFzdFZhbHVlKHRlc3QpLFxuICAgICAgICBcImNvbnNlcXVlbnRcIjogYXN0VmFsdWUoY29uc2VxdWVudCksXG4gICAgICAgIFwiYWx0ZXJuYXRlXCI6IGFzdFZhbHVlKGFsdGVybmF0ZSlcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFzdFRocm93KG5hbWUsIGFyZ3MpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBcInR5cGVcIjogXCJUaHJvd1N0YXRlbWVudFwiLFxuICAgICAgICBcImFyZ3VtZW50XCI6IHtcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIk5ld0V4cHJlc3Npb25cIixcbiAgICAgICAgICAgIFwiY2FsbGVlXCI6IGFzdFZhclJlZihuYW1lKSxcbiAgICAgICAgICAgIFwiYXJndW1lbnRzXCI6IG1hcEFyZ3MoYXJncylcbiAgICAgICAgfVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdE5vdChleHByKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiVW5hcnlFeHByZXNzaW9uXCIsXG4gICAgICAgIFwib3BlcmF0b3JcIjogXCIhXCIsXG4gICAgICAgIFwiYXJndW1lbnRcIjogYXN0VmFsdWUoZXhwciksXG4gICAgICAgIFwicHJlZml4XCI6IHRydWVcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBhc3RSZXR1cm4odmFsKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgXCJ0eXBlXCI6IFwiUmV0dXJuU3RhdGVtZW50XCIsXG4gICAgICAgIFwiYXJndW1lbnRcIjogYXN0VmFsdWUodmFsKVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGFzdFRvQ29kZShhc3QpIHsgICAgICAgXG4gICAgcmV0dXJuIGVzY29kZWdlbi5nZW5lcmF0ZShhc3QsIHtcbiAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICBpbmRlbnQ6IHtcbiAgICAgICAgICAgICAgICBzdHlsZTogJyAgICAnLFxuICAgICAgICAgICAgICAgIGJhc2U6IDAsXG4gICAgICAgICAgICAgICAgYWRqdXN0TXVsdGlsaW5lQ29tbWVudDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBuZXdsaW5lOiAnXFxuJyxcbiAgICAgICAgICAgIHNwYWNlOiAnICcsXG4gICAgICAgICAgICBqc29uOiBmYWxzZSxcbiAgICAgICAgICAgIHJlbnVtYmVyOiBmYWxzZSxcbiAgICAgICAgICAgIGhleGFkZWNpbWFsOiBmYWxzZSxcbiAgICAgICAgICAgIHF1b3RlczogJ3NpbmdsZScsXG4gICAgICAgICAgICBlc2NhcGVsZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbXBhY3Q6IGZhbHNlLFxuICAgICAgICAgICAgcGFyZW50aGVzZXM6IHRydWUsXG4gICAgICAgICAgICBzZW1pY29sb25zOiB0cnVlLFxuICAgICAgICAgICAgc2FmZUNvbmNhdGVuYXRpb246IGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIGNvbW1lbnQ6IHRydWVcbiAgICB9KTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgYXN0UHJvZ3JhbSxcbiAgICBhc3RSZXF1aXJlLFxuICAgIGFzdFZhckRlY2xhcmUsXG4gICAgYXN0Q2xhc3NEZWNsYXJlLFxuICAgIGFzdE1lbWJlck1ldGhvZCxcbiAgICBhc3RDYWxsLFxuICAgIGFzdFlpZWxkLFxuICAgIGFzdEF3YWl0LFxuICAgIGFzdFRoaXMsXG4gICAgYXN0SWQsXG4gICAgYXN0VmFyUmVmLFxuICAgIGFzdFZhbHVlLFxuICAgIGFzdEZ1bmN0aW9uLFxuICAgIGFzdEFub255bW91c0Z1bmN0aW9uLFxuICAgIGFzdEFycm93RnVuY3Rpb24sXG4gICAgYXN0SWYsXG4gICAgYXN0Q29uZGl0aW9uYWwsXG4gICAgYXN0QmluRXhwLFxuICAgIGFzdExvZ2ljYWxFeHAsXG4gICAgYXN0QmxvY2ssXG4gICAgYXN0TWF0Y2hPYmplY3QsXG4gICAgYXN0RXhwcmVzc2lvbixcbiAgICBhc3RBc3NpZ24sXG4gICAgYXN0QWRkTWVtYmVyLFxuICAgIGFzdE1lbWJlcixcbiAgICBhc3RQdXNoSW5Cb2R5LFxuICAgIGFzdFRocm93LFxuICAgIGFzdE5vdCxcbiAgICBhc3RSZXR1cm4sXG4gICAgYXN0TGl0ZXJhbCxcbiAgICBhc3RQYXJhbXMsXG4gICAgYXN0QXJyYXlBY2Nlc3MsXG4gICAgYXN0VG9Db2RlXG59OyJdfQ==